<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<link rel="stylesheet" type="text/css" href="../css/common.css" media="all">
<script language="javascript" type="text/javascript" src="../js/menu_base.js"></script>
<script language="javascript" type="text/javascript" src="../js/menu.js"></script>
<script language="javascript" type="text/javascript" src="../js/common.js"></script>
<script language="javascript" type="text/javascript" src="../js/fvt.js"></script>
<style type="text/css">
td.width_ipv6ta{width:270px}
td.width_ipv6td{width:15px}
td.width_ipv6tp{width:100px}
td.width_lanset2{width:210px}
div.width_lanset3{margin-left:20px}
select.width_lansetEnable{width:128px}
td.titlecell{background-color:LightGray;color:#00008B}
td.td_width{width:40px}
td{margin:2px 2px;padding:5px 2px;}
input.narrowInput{width:150px;}
.button {
	background-color: #e7e7e7;
	color: black;
	margin: 2px 2px;
	text-align: center;
	border-radius: 4px;
	border: 1px solid #ccc;
}
.button:hover {
	background-color: #ccc;
	color: darkblue;
	border: 1px solid darkblue;
}
.button1{width: 230px;}
.button2{width: 150px;}
.button3{width: 100px;}
</style>
<script language="javascript" type="text/javascript">
var v6showkey = new Array("system_run_ipv6ready");

var v6matakey = new Array("wan0_ipv6_iana_mode", "wan0_ipv6_iapd_mode",
						"lan0_ipv6_ra_abit", "lan0_ipv6_ra_mbit", "lan0_ipv6_ula_prefix",
						"lan0_ipv6_dns_proxy_enable", "wan0_ipv6_enforce_mode",
						"wan0_ipv6_iapd_prefix_length_hint", "lan0_ipv6_ra_mtu_wanif_index");

function switch_config(mode)
{
	if (mode == "ipv6logo_eth")
		msg="IPv6 Logo Testing mode(wan via eth)"
	else if (mode == "ipv6logo_pon")
		msg="IPv6 Logo Testing mode(wan via pon)"
	else
		msg="CHT Normal Operration mode"

	if (confirm("Are you sure you want to change the configuration to "+msg+" ?\nAfter applying changes, ONT will reboot automatically."))
		{
		fvt_form_submit('ipv6_logo_form',mode);
		//window.top.location.href="wwwctrl.cgi?action=wait_restart&time=125";
		document.ipv6_logo_form.action="wwwctrl.cgi?action=wait_restart&time=150";
		document.ipv6_logo_form.submit();
		}
}

function fvt_form_init(form_name)
{
	if (form_name=='ipv6_logo_form' || form_name=='*')
		{
		if (fvt_meta_config('system_run_ipv6ready')=='0')
			{
			document.getElementById("ipv6logo_config_status").style.color = 'black';
			document.getElementById("ipv6logo_config_status").innerHTML = "CHT Normal configuration mode";
			}
		else if (fvt_meta_config('system_run_ipv6ready')=='1')
			{
			document.getElementById("ipv6logo_config_status").style.color = 'blue';
			document.getElementById("ipv6logo_config_status").innerHTML = "IPv6 LOGO Testing configuration mode (Eth)";
			}
		else
			{
			document.getElementById("ipv6logo_config_status").style.color = 'blue';
			document.getElementById("ipv6logo_config_status").innerHTML = "IPv6 LOGO Testing configuration mode (Pon)";
			}
		document.getElementById("ipv6logo_config_status").style.fontSize = "18px";
		get_v6metaky();
		fvt_form_obj_set('ipv6_logo_form', 'wanmtusize', fvt_meta_config('kv_wan_mtu_size'));
		fvt_form_obj_set('ipv6_logo_form', 'lanmtusize', fvt_meta_config('kv_lan_mtu_size'));
		}
	document.getElementById('wan_pon').style.display = 'none';
	//document.getElementById('wan_pon').style.display = '';
}

function fvt_form_submit(form_name, mode)
{
	fvt_paramlist_clear();

	if (form_name=='ipv6_logo_form' || form_name=='*')
		{

		if (mode=="cht_default")
			{
			fvt_paramlist_cat_str('system_run_ipv6ready',"0");
			}
		if (mode=="ipv6logo_eth" )
			{
			fvt_paramlist_cat_str('system_run_ipv6ready',"1");
			}
		if (mode=="ipv6logo_pon")
			{
			fvt_paramlist_cat_str('system_run_ipv6ready',"2");
			}
		fvt_paramlist_cat_str('reboot', "1");
		}

	fvt_paramlist_presubmit(form_name);
}

function saveChanges()
{
	fvt_paramlist_clear();

	set_v6metaky();

	fvt_paramlist_presubmit('ipv6_logo_form');
	document.ipv6_logo_form.submit();
}

function RebootONT()
{
	if (confirm("Are you sure you want to reboot ONT?"))
		{
		fvt_paramlist_clear();

		fvt_paramlist_cat_str('reboot', "1");

		fvt_paramlist_presubmit('ipv6_logo_form');
		document.ipv6_logo_form.submit();
		}
}

function get_v6metaky()
{
	for (var i = 0; i < v6showkey.length; i++)
		{
		fvt_form_obj_set("ipv6_logo_form", v6showkey[i], fvt_meta_config(v6showkey[i]));
		}
	for (var i = 0; i < v6matakey.length; i++)
		{
		fvt_form_obj_set("ipv6_logo_form", v6matakey[i], fvt_meta_config(v6matakey[i]));
		}
}

function set_v6metaky()
{
	for (var i = 0; i < v6matakey.length; i++)
		{
		fvt_paramlist_cat_str(v6matakey[i],fvt_form_obj_get("ipv6_logo_form", v6matakey[i]));
		}
}

function list_v6metaky()
{
	var target=document.getElementById("metahead")
	for (var i = 0; i < v6matakey.length; i++)
		{
		//document.write("<tr><td>");
		//document.write(v6matakey[i]);
		//document.write("</td><td></td><td>");
		//document.write("<input name="+v6matakey[i]+" id=id_"+v6matakey[i]+" class='narrowInput'>");
		//document.write("</td></tr>");
		var new_row = document.createElement('tr');
		new_row.insertCell(0).innerHTML = v6matakey[i];
		new_row.insertCell(1).innerHTML = "";
		new_row.insertCell(2).innerHTML = "<input name="+v6matakey[i]+" id=id_"+v6matakey[i]+" class='narrowInput'>";
		target.parentNode.appendChild( new_row );
		//document.getElementById("metahead").parentNode.appendChild( new_row );
		//insertAfter(document.getElementById("metahead"), new_row);
		}
}

function show_v6metaky()
{
	var target=document.getElementById("metahead")
	for (var i = 0; i < v6showkey.length; i++)
		{
		//document.write("<tr><td>");
		//document.write(v6showkey[i]);
		//document.write("</td><td></td><td>");
		//document.write("<input name="+v6showkey[i]+" id=id_"+v6showkey[i]+" class='narrowInput' disabled='disabled'>");
		//document.write("</td></tr>");
		var new_row = document.createElement('tr');
		new_row.insertCell(0).innerHTML = v6showkey[i];
		new_row.insertCell(1).innerHTML = "";
		new_row.insertCell(2).innerHTML = "<input name="+v6showkey[i]+" id=id_"+v6showkey[i]+" class='narrowInput' disabled='disabled'>";
		target.parentNode.appendChild( new_row );
		//insertAfter(document.getElementById("metahead"), new_row);
		}
}

function insertAfter(target, el)
{
	if( !target.nextSibling )
		{
		target.parentNode.appendChild( el );
		}
	else
		{
		target.parentNode.insertBefore( el, target.nextSibling );
		}
 };

function SETMTU( inf )
{
	fvt_paramlist_clear();

	if ( inf == "wan" )
		{
		mtu_size=document.getElementById("id_wanmtusize").value;
		//alert("wan mtu="+mtu_size);
		fvt_paramlist_cat_str('kv_setwanmtu', mtu_size);
		}
	else if ( inf == "lan" )
		{
		mtu_size=document.getElementById("id_lanmtusize").value;
		//alert("lan mtu="+mtu_size);
		fvt_paramlist_cat_str('kv_setlanmtu', mtu_size);
		}

	fvt_paramlist_presubmit('ipv6_logo_form');
	document.ipv6_logo_form.submit();
}

function WANSEND( wanaction )
{
	fvt_paramlist_clear();

	if ( wanaction == "Confirm" )
		{
		fvt_paramlist_cat_str('kv_ipv6wanaction', "wanConfirm");
		}
	else if ( wanaction == "Release" )
		{
		fvt_paramlist_cat_str('kv_ipv6wanaction', "wanRelease");
		}

	fvt_paramlist_presubmit('ipv6_logo_form');
	document.ipv6_logo_form.submit();
}

function ChangeText() {
	if (fvt_meta_config('system_run_ipv6ready')=='2')
		{
		Wan_If="pon0.4082"
		Lan_If="eth0.3"
		}
	else
		{
		Wan_If="eth0.5"
		Lan_If="eth0.2"
		}

    document.getElementById('id_wanmtu').innerHTML = "echo 1500 > /proc/sys/net/ipv6/conf/"+Wan_If+"/mtu";
    document.getElementById('id_lanmtu').innerHTML = "echo 1500 > /proc/sys/net/ipv6/conf/"+Lan_If+"/mtu";
    document.getElementById('id_wandownup').innerHTML = "ifconfig "+Wan_If+" down; ifconfig "+Wan_If+" up";
}
//-->
</script>
</head>

<body align="left" onload="fvt_form_init('ipv6_logo_form');ChangeText();">
<div id="container">
<table align="center" width="90%"><tbody>
<tr><td valign="top">
<form id="ipv6_logo_form" name="ipv6_logo_form" method="post" action="">
<fieldset>
	<div class="lv1_title">Advanced Setup&nbsp;&gt;&nbsp;IPv6 LOGO Testing/CHT Default config Settings</div>
</fieldset>
<div class="div1_indent lv2_new">
<div>
	<table><tbody>
	<tr>
		<th style="color:darkblue;font-size:16px">Current configuration:</th>
	</tr>
	<tr>
		<td name="ipv6logo_config_status" id="ipv6logo_config_status"></td>
	</tr>
	<tr></tr>
	<tr>
		<td id='id_ipv6logo_eth'>
			<button class="button button1" onclick="switch_config('ipv6logo_eth')" id="id_ipv6logo_btn">
				Change to IPv6 LOGO Test Setting <br> Wan=eth
			</button>
		</td>
	</tr>
	<tr id='wan_pon'>
		<td id='id_ipv6logo_pon'>
			<button class="button button1" onclick="switch_config('ipv6logo_pon')" id="id_ipv6logo_btn">
				Change to IPv6 LOGO Test Setting <br> Wan=pon
			</button>
		</td>
	</tr>
	<tr>
		<td id='id_cht_default'>
			<button class="button button1" onclick="switch_config('cht_default')" id="id_chtdefault_btn">
				Change to CHT Default Setting
			</button>
		</td>
	</tr>
	</tbody></table>

</div>
<br>
<hr>
	<div>
	<table><tbody>
		<tr>
		<td width="150px">Reboot ONT</td>
		<td width="100px">
			<button class="button button2" onclick="RebootONT()" name="applybtn">
				Reboot
			</button>
		</td>
		</tr>
	</tbody></table>
	</div>
<br>
	<div>
	<table><tbody>
		<tr>
		<td width="150px">WAN MTU大小設定</td>
		<td><input name="wanmtusize" id="id_wanmtusize" class="narrowInput"></td>
		<td width="100px">
			<input type="button" class="button3" onclick="SETMTU('wan')" name="applybtn" value="Set WAN MTU">
		</td>
		<td id="id_wanmtu">echo 1500 > /proc/sys/net/ipv6/conf/eth0.5/mtu</td>
		</tr>
		<tr>
		<td>LAN MTU大小設定</td>
		<td><input name="lanmtusize" id="id_lanmtusize" class="narrowInput"></td>
		<td>
			<input type="button" class="button3" onclick="SETMTU('lan')" name="applybtn" value="Set LAN MTU">
		</td>
		<td id="id_lanmtu">echo 1500 > /proc/sys/net/ipv6/conf/eth0.2/mtu</td>
		</tr>
		<tr></tr>
		<tr>
		<td>WAN送Confirm</td>
		<td></td>
		<td>
			<input type="button" class="button3" onclick="WANSEND('Confirm')" name="applybtn" value="WAN Confirm">
		</td>
		<td id="id_wandownup">ifconfig eth0.5 down; ifconfig eth0.5 up</td>
		</tr>
		<td>WAN送Release</td>
		<td></td>
		<td>
			<input type="button" class="button3" onclick="WANSEND('Release')" name="applybtn" value="WAN Release">
		</td>
		<td>killall -USR2 odhcp6c</td>
		</tr>
	</tbody></table>
	</div>

<hr>
<br>
<div>
	<table><tbody>
	<tr>
		<th style="color:darkblue;font-size:16px">Parameter/Value Settings:</th>
	</tr>
	<tr id="metahead"><td class='titlecell' width='250' align='center'>Parameter</td>
	<td width='5'></td>
	<td class='titlecell' align='center'>Value</td></tr>
		<script language="javascript" type="text/javascript">
			show_v6metaky();
			list_v6metaky();
		</script>
	</tbody></table>
</div>
	<div class="top_cwmp2">
	<table><tbody>
		<tr>
		<td></td>
			<td class="button_center">
				<input type="button" onclick="saveChanges()" name="applybtn" value="Apply Changes" class="width_apply">
			</td>
		<td></td>
		</tr>
	</tbody></table>
	</div>

</div>
</form>
<hr>
<br>
</td></tr>
</tbody></table>
</div>

</body>
</html>

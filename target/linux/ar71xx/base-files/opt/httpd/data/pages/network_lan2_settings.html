<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<link rel="stylesheet" type="text/css" href="../css/common.css" media="all">
<script language="javascript" type="text/javascript" src="../js/menu_base.js"></script>
<script language="javascript" type="text/javascript" src="../js/menu.js"></script>
<script language="javascript" type="text/javascript" src="../js/common.js"></script>
<script language="javascript" type="text/javascript" src="../js/fvt.js"></script>

<script language="javascript" type="text/javascript">

var DHCPSEnable;
var DhcpRelayEnable;

var msg_notice = "Change setting will stop connection before restart service";
var ptm_num="1";
var atm_num="0";

var i=0;
var DHCPenable=0,DHCP_s=0,DHCP_e=0;

function valueMatch(s1, s2, match_return)
{
	if(s1 == s2)
		return match_return;
	else
		return "";
}

function setValue(val)
{
	document.getElementById("mm_"+val).value =
		(document.getElementById("id_"+val).checked)?"1":"0";
	//(document.getElementById("id_"+val).checked)?"on":"off";
}

function setPrefixValue(val)
{
	if (document.getElementById("id_UserSet").checked)
	{
		document.getElementById("mm_"+val).value =0;
		document.getElementById("id_USvalue").disabled=false;
	}
	else if (document.getElementById("id_Dhcpv6").checked)
	{
		document.getElementById("mm_"+val).value =1;
		document.getElementById("id_USvalue").disabled=true;
	}
	else
	{
		document.getElementById("mm_"+val).value =2;
		document.getElementById("id_USvalue").disabled=true;
	}
}

function changedhcpIP(index)
{
	document.getElementById("id_DHCPSIPStart"+index).value = document.getElementById("id_LanIPAddr"+index).value;
	document.getElementById("id_DHCPSIPEnd"+index).value = document.getElementById("id_LanIPAddr"+index).value;
	//document.getElementById("id_PoolIPStart"+index).value = document.getElementById("id_LanIPAddr"+index).value;
	//document.getElementById("id_PoolIPEnd"+index).value = document.getElementById("id_LanIPAddr"+index).value;
	document.getElementById("id_DhcpDnsServer1"+index).value = document.getElementById("id_LanIPAddr"+index).value;
}

function check_process()
{
	var process="Success";
	if (process=="Existed")
		warn_wait();
		//alert("Please wait!!Another client is upgading firmware.");
}

function isBridgeMode()
{
	for (i=0; i< document.lan2setting_form.elements.length; i++)
	{
		if(document.lan2setting_form.elements[i].name == "DHCPSEnable")
			DHCPenable = i;
	}
	if ((ptm_num=="0")&&(atm_num=="0"))
	{
		for (i=DHCPenable;i<document.lan2setting_form.elements.length-1;i++)
			document.lan2setting_form.elements[i].disabled=true;
	}

}

function enableItem(value)
{
	for (i=0; i< document.lan2setting_form.elements.length; i++)
	{
		if(document.lan2setting_form.elements[i].name == "DHCPSRelayServer1")
			DHCP_s = i;
		if(document.lan2setting_form.elements[i].name == "DHCPSNotAssignIP10")
			DHCP_e = i;
	}
	if (value==1)
	{
		for (i=DHCP_s;i<DHCP_e;i++)
			document.lan2setting_form.elements[i].disabled=false;

	}
	else
	{
		for (i=DHCP_s;i<DHCP_e;i++)
			document.lan2setting_form.elements[i].disabled=true;
	}
}

function dhcpChange()
{

	if ( document.lan2setting_form.DHCPSEnable.selectedIndex == 0 )
	{
		enableItem(0);
		document.getElementById("dhcpServerTbl").style.display="none";
		document.getElementById("dhcpServerTb2").style.display="none";
		document.getElementById("dhcpServerTb3").style.display="none";
		document.getElementById("dhcpServerTb4").style.display="none";
		document.getElementById("dhcpServerTb5").style.display="none";
	}
	else if ( document.lan2setting_form.DHCPSEnable.selectedIndex == 1 )
	{
		enableItem(1);
		document.getElementById("dhcpServerTbl").style.display="";
		document.getElementById("dhcpServerTb2").style.display="";
		document.getElementById("dhcpServerTb3").style.display="";
		document.getElementById("dhcpServerTb4").style.display="";
		document.getElementById("dhcpServerTb5").style.display="";
	}
	else
	{
		enableItem(0);
		document.getElementById("dhcpServerTbl").style.display="none";
		document.getElementById("dhcpServerTb2").style.display="none";
		document.getElementById("dhcpServerTb3").style.display="none";
		document.getElementById("dhcpServerTb4").style.display="none";
		document.getElementById("dhcpServerTb5").style.display="none";
	}
}

function check_symbol(name)
{
	if (!isBlank(name))
	{
		for(i=0;i<name.length;i++)
		{
			c=name.charAt(i);
			if((c!='_')&&(c!='-')&&(c!='.')&&(!((c>='a')&&(c<='z')))&&(!((c>='A')&&(c<='Z')))&&(!((c>='0')&&(c<='9'))))
				return false;
		}
	}
	return true;
}

function checkClientRange(gw,start,end)
{
	var gw_d,start_d,end_d;

	gw_d = getDigit(gw,4);
	gw_d +=	getDigit(gw,3)*256;
	gw_d +=	getDigit(gw,2)*256;
	gw_d +=	getDigit(gw,1)*256;

	start_d	= getDigit(start,4);
	start_d	+= getDigit(start,3)*256;
	start_d	+= getDigit(start,2)*256;
	start_d	+= getDigit(start,1)*256;

	end_d =	getDigit(end,4);
	end_d += getDigit(end,3)*256;
	end_d += getDigit(end,2)*256;
	end_d += getDigit(end,1)*256;
	if( start_d <= end_d ){
		if((start_d <= gw_d) &&	(gw_d <= end_d))
			return false;
		else
			return true;
	}

	return false;
}

function checkRelayVenderId()
{
	if (document.getElementById("id_DHCPSRelayServer2VID").value.length==0)
	{
		var item="Mapping Vender ID";
		warn_not_empty(item);
		//alert(item+" can't be empty!");
		return false;
	}
	return true;
}

function option_dnsrelay()
{
	var dnsrelay=false;
	if(document.lan2setting_form.DhcpDNSRelay[0].checked) { dnsrelay = true; }
	else { dnsrelay = false; }
}


function saveChanges()
{
	var msg;
	var no;
	var i;
	var j;

	merge_ip("id_LanIPAddr","id_LanIPAddr1","id_LanIPAddr2","id_LanIPAddr3","id_LanIPAddr4");
	merge_ip("id_LanNetmask","id_LanNetmask1","id_LanNetmask2","id_LanNetmask3","id_LanNetmask4");
	merge_ip("id_DhcpNetmask","id_DhcpNetmask1","id_DhcpNetmask2","id_DhcpNetmask3","id_DhcpNetmask4");
	merge_ip("id_DhcpDnsServer","id_DhcpDnsServer11","id_DhcpDnsServer12","id_DhcpDnsServer13","id_DhcpDnsServer14");
	merge_ip("id_DhcpDnsServer2","id_DhcpDnsServer21","id_DhcpDnsServer22","id_DhcpDnsServer23","id_DhcpDnsServer24");
	merge_ip("id_DHCPSIPStart","id_DHCPSIPStart1","id_DHCPSIPStart2","id_DHCPSIPStart3","id_DHCPSIPStart4");
	merge_ip("id_DHCPSIPEnd","id_DHCPSIPEnd1","id_DHCPSIPEnd2","id_DHCPSIPEnd3","id_DHCPSIPEnd4");

	if ((document.lan2setting_form.LanIPAddr.value=="")||(document.lan2setting_form.LanIPAddr.value==fvt_meta_config('lan0_ip'))
	||(document.lan2setting_form.LanIPAddr.value==fvt_meta_config('lan0_alias0_ip')))
	{
		msg="IP Address";
		no="";
		warn_invalid(msg);
		//alert(msg +" " +no + " is invalid");
		return false;
	}

	// ip.match(/^169.254|0.0.0.0/g);
	if (document.lan2setting_form.LanIPAddr.value.match(/192.168.[2][.]/g) )
	{
		alert("192.168.2.X section is reserved for system!");
		document.getElementById("id_LanIPAddr3").value="";
		document.getElementById("id_DHCPSIPStart3").value="";
		document.getElementById("id_DHCPSIPEnd3").value="";
		return false;
	}

	if ((document.lan2setting_form.LanNetmask.value == "")||(!check_netmask(document.lan2setting_form.LanNetmask.value)))
	{
		warn_invalid("Subnet Mask");
		//alert("Subnet Mask is invalid!");
		return false ;
	}

	if (!check_ip(document.lan2setting_form.LanIPAddr.value,document.lan2setting_form.LanNetmask.value))
		{
				msg="IP Address";
				no="";
				warn_invalid(msg);
				//alert(msg +" " +no + " is invalid");
				return false;
		}

	if (document.lan2setting_form.Lan2IPAddr.value=="" && document.lan2setting_form.Lan2Netmask.value != "")
	{
		msg="Second IP Address";
		no="";
		warn_invalid(msg);
		//alert(msg +" " +no + " is invalid");
		return false;
	}

	if (document.lan2setting_form.Lan2IPAddr.value!="" && document.lan2setting_form.Lan2Netmask.value == "")
	{
		warn_invalid("Second Subnet Mask");
		//alert("Subnet Mask is invalid!");
		return false ;
	}
	if (document.lan2setting_form.Lan2IPAddr.value !="" && document.lan2setting_form.Lan2Netmask.value != "")
	{
		// ip.match(/^169.254|0.0.0.0/g);
		if (document.lan2setting_form.Lan2IPAddr.value.match(/192.168.[2][.]/g) )
		{
			alert("192.168.2.X section is reserved for system!");
			document.getElementById("id_Lan2IPAddr3").value="";
			return false;
		}

		if (document.lan2setting_form.Lan2IPAddr.value=="")
		{
			msg="Second IP Address";
			no="";
			warn_invalid(msg);
			//alert(msg +" " +no + " is invalid");
			return false;
		}

		if ((document.lan2setting_form.Lan2Netmask.value == "")||(!check_netmask(document.lan2setting_form.Lan2Netmask.value)))
		{
			warn_invalid("Second Subnet Mask");
			//alert("Subnet Mask is invalid!");
			return false ;
		}

		if (!check_ip(document.lan2setting_form.Lan2IPAddr.value,document.lan2setting_form.Lan2Netmask.value))
			{
					msg="Second IP Address";
					no="";
					warn_invalid(msg);
					//alert(msg +" " +no + " is invalid");
					return false;
			}
	}

	if ( document.lan2setting_form.DHCPSEnable.selectedIndex == 1)
	{
		if (! check_ip(document.lan2setting_form.DHCPSIPStart.value,document.lan2setting_form.LanNetmask.value))
		{
			warn_invalid("DHCP Starting IP Address");
			//alert("DHCP Starting IP Address is invalid!");
			return false;
		}

		if( parseInt(document.getElementById('id_DHCPSIPEnd4').value,10) < parseInt(document.getElementById('id_DHCPSIPStart4').value,10) )
		{
			alert("DHCP pool end IP must over than start");
			return false;
		}

		//if( !(document.getElementById('id_DHCPSIPStart4').value >=0 && document.getElementById('id_DHCPSIPEnd4').value <251) &&
		//	!(document.getElementById('id_DHCPSIPStart4').value >254 && document.getElementById('id_DHCPSIPEnd4').value <=255) )
		//{
		//	alert("DHCP pool range 251~254 is reserved for system");
		//	return false;
		//}

		if ( !checkSubnet(document.lan2setting_form.LanIPAddr.value,document.lan2setting_form.LanNetmask.value,document.lan2setting_form.DHCPSIPStart.value))
		{
			warn_invalid("DHCP Starting IP Address");
		//	alert("DHCP Starting IP Address is invalid!");
			document.lan2setting_form.DHCPSIPStart.value = document.lan2setting_form.DHCPSIPStart.defaultValue;
			return false;
		}

			if ( !check_ip(document.lan2setting_form.DHCPSIPEnd.value,document.lan2setting_form.LanNetmask.value))
			{
				warn_invalid("DHCP Ending IP Address");
				//alert("DHCP Ending IP Address is invalid!");
				return false;
			}

			if ( !checkSubnet(document.lan2setting_form.LanIPAddr.value,document.lan2setting_form.LanNetmask.value,document.lan2setting_form.DHCPSIPEnd.value))
			{
				warn_invalid("DHCP Ending IP Address");
				//alert("DHCP Ending IP Address is invalid!");
				document.lan2setting_form.DHCPSIPEnd.value = document.lan2setting_form.DHCPSIPEnd.defaultValue;
				return false;
			}
			if ( !checkClientRange(document.lan2setting_form.LanIPAddr.value,document.lan2setting_form.DHCPSIPStart.value,document.lan2setting_form.DHCPSIPEnd.value) )
			{
				warn_ipdhcp();
				//alert("Invalid DHCP range value! Please check IP address and DHCP Address!");
				return false;

			}
	}

	if ( document.lan2setting_form.DHCPSEnable.selectedIndex != 1 )
	{
		if ( document.lan2setting_form.lan_gateway.value=="")
			document.lan2setting_form.lan_gateway.value = "0.0.0.0";

		if (document.lan2setting_form.lan_gateway.value!="0.0.0.0")
		{
			if ( !check_ip(document.lan2setting_form.lan_gateway.value))
			{
				msg="Gateway address";
				no="";
				warn_invalid(msg);
				//alert(msg +" " +no + " is invalid");
				return false;
			}

			if ( !checkSubnet(document.lan2setting_form.LanIPAddr.value,document.lan2setting_form.LanNetmask.value,document.lan2setting_form.lan_gateway.value))
			{
				//alert("Invalid Gateway address.");
				warn_invalid("Gateway address");
				//alert("Gateway address is invalid.");
				document.lan2setting_form.lan_gateway.value = document.lan2setting_form.lan_gateway.defaultValue;
				return false;
			}
		}
	}

	if ( document.lan2setting_form.DHCPSEnable.selectedIndex == 2 )
	{
		if (document.lan2setting_form.DHCPSRelayServer1.value.length==0)
		{
			warn_not_empty_int("DHCP Relay Server",1);
			//alert("DHCP Relay Server1 can not be empty!");
			return false;
		}
		if (document.lan2setting_form.DHCPSRelayServer1.value.length>0)
		{
			if ( !check_ip(document.lan2setting_form.DHCPSRelayServer1.value))
			{
				warn_invalid_int("DHCP Relay Server",1);
				//alert("DHCP Relay Server1 is invalid!");
				return false;
			}
		}
		if (document.lan2setting_form.DHCPSRelayServer2.value.length>0)
		{
			if ( !check_ip(document.lan2setting_form.DHCPSRelayServer2.value))
			{
				warn_invalid_int("DHCP Relay Server",2);
				//alert("DHCP Relay Server2 is invalid!");
				return false;
			}
			if (!checkRelayVenderId())
				return false;
		}
		if(confirm_lan())
		{
			fvt_form_submit('lan2setting_form');
			document.lan2setting_form.submit();
			return true;
		}
		else
			return false;
	}

	if ( document.lan2setting_form.DHCPSEnable.selectedIndex == 1 )
	{
		if ( document.lan2setting_form.DHCPSLeaseTime.value=="" )
		{
			warn_not_empty("DHCP Lease Time");
			//alert("DHCP Lease Time is empty.");
			return;
		}

		if ( !check_integer(document.lan2setting_form.DHCPSLeaseTime.value))
		{
			var item = " in DHCP Lease Time ";
			warn_lantime();
			//alert("Each character of the number must be 0~9 "+item);
			return;
		}

		if ( !check_integer_range(document.lan2setting_form.DHCPSLeaseTime.value, 60, 999999) )
		{
			warn_larger("DHCP Lease Time",60);
			//alert("DHCP Lease Time should be larger than 60");
			return;
		}

	}

	fvt_form_submit('lan2setting_form');
	document.lan2setting_form.submit();
	return true;
}

function Ethjoin(port)
{
	//if (document.lan2setting_form.getElementById('eth'+port+'join').checked ==true)
//	if (document.getElementById("id_eth"+port+"join").checked ==true)
//	{
//		alert("port " + port +" enable");
//	}
//	else
//	{
//		alert("port " + port +" disable");
//	}
}

function fvt_form_init(form_name)
{

	if (form_name=='lan2setting_form' || form_name=='*') {
		fvt_form_obj_set("lan2setting_form", "LanIPAddr", fvt_meta_config('lan1_ip'));
		fvt_form_obj_set("lan2setting_form", "LanNetmask", fvt_meta_config('lan1_netmask'));
		fvt_form_obj_set("lan2setting_form", "DhcpNetmask", fvt_meta_config('dhcp1_netmask'));
		fvt_form_obj_set("lan2setting_form", "DhcpDnsServer", fvt_meta_config('dhcp1_dns_server'));
		//document.getElementById("dhcpDNSServerTb").style.display=""; //Show DNS server table
		//if( typeof meta_config['dhcp1_dns_server2'] === "undefined" ){
		//	document.getElementById("dhcpDNSServer2Tb").style.display="none";
		//}else{
		//	document.getElementById("dhcpDNSServer2Tb").style.display="";
		//	fvt_form_obj_set("lan2setting_form", "DhcpDnsServer2", fvt_meta_config('dhcp1_dns_server2'));
		//}

		fvt_form_obj_set("lan2setting_form", "Lan2IPAddr", fvt_meta_config('lan1_alias0_ip'));
		fvt_form_obj_set("lan2setting_form", "Lan2Netmask", fvt_meta_config('lan1_alias0_netmask'));

		fvt_form_obj_set("lan2setting_form", "DHCPSEnable", fvt_meta_config('dhcp1_enable'));		//select-one

		fvt_form_obj_set("lan2setting_form", "DHCPSIPStart", fvt_meta_config('dhcp1_number_start'));
		fvt_form_obj_set("lan2setting_form", "DHCPSIPEnd", fvt_meta_config('dhcp1_number_end'));
		fvt_form_obj_set("lan2setting_form", "DHCPSLeaseTime", fvt_meta_config('dhcp1_leasetime'));

		fvt_form_obj_set("lan2setting_form", "DHCPAction", fvt_meta_config('dhcp_capability'));

		fvt_form_obj_set("lan2setting_form", "DhcpDNSRelay", fvt_meta_config('dhcp1_dns_relay'));
		option_dnsrelay();
	}

	for ( i=1 ; i<=3 ; i++ )
	{
		var dev_br1="dev_br1_member_"+i;
		var port_no= "id_eth"+(i+1)+"join";
		var eth_no="eth0."+(i+2);  // dev_br1_member_1 = id_eth2join = eth0.3
		if(fvt_meta_config(dev_br1) == eth_no)
		{
			document.getElementById(port_no).checked=true;
		//	alert( dev_br1 + " - " + port_no + " - " + eth_no);
		}
		else
		{
			document.getElementById(port_no).checked=false;
		}
	}
}

function fvt_form_submit(form_name) {
	fvt_paramlist_clear();
//	var acl_lan16=fvt_form_obj_get("lan2setting_form", "LanIPAddr")+"\/"+octet2cidr(fvt_form_obj_get("lan2setting_form", "LanNetmask"));
	if (form_name=='lan2setting_form' || form_name=='*') {
		if(fvt_form_obj_get("lan2setting_form", "LanIPAddr")!=fvt_meta_config("lan1_ip") ||
			fvt_form_obj_get("lan2setting_form", "LanNetmask")!=fvt_meta_config("lan1_netmask")||
			fvt_form_obj_get("lan2setting_form", "Lan2IPAddr")!=fvt_meta_config("lan1_alias0_ip")||
			fvt_form_obj_get("lan2setting_form", "Lan2Netmask")!=fvt_meta_config("lan1_alias0_netmask"))
		{
			//if (confirm("Modification of IP Address or Subnet Mask will result in the rebooting of CPE,OK?"))
			//{
				fvt_paramlist_cat_str('lan1_ip', fvt_form_obj_get("lan2setting_form", "LanIPAddr"));
				fvt_paramlist_cat_str('lan1_netmask', fvt_form_obj_get("lan2setting_form", "LanNetmask"));
				fvt_paramlist_cat_str('lan1_alias0_ip', fvt_form_obj_get("lan2setting_form", "Lan2IPAddr"));
				fvt_paramlist_cat_str('lan1_alias0_netmask', fvt_form_obj_get("lan2setting_form", "Lan2Netmask"));

			//	document.getElementById('lan2setting_form').action="wwwctrl.cgi?action=wait_restart";
			//	document.getElementById('lan2setting_form').target = "contentfrm";
			//	fvt_paramlist_cat_str('reboot', "1");
			//}
		}

		fvt_paramlist_cat_str('dhcp1_wins_server', fvt_form_obj_get("lan2setting_form", "LanIPAddr"));
		fvt_paramlist_cat_str('dhcp1_gateway', fvt_form_obj_get("lan2setting_form", "LanIPAddr"));
		fvt_paramlist_cat_str('dhcp1_dns_server', fvt_form_obj_get("lan2setting_form", "LanIPAddr"));
		fvt_paramlist_cat_str('dhcp1_netmask', fvt_form_obj_get("lan2setting_form", "DhcpNetmask"));

		var subnet_item1 = document.getElementById("id_LanIPAddr1").value & document.getElementById("id_DhcpNetmask1").value;
		var subnet_item2 = document.getElementById("id_LanIPAddr2").value & document.getElementById("id_DhcpNetmask2").value;
		var subnet_item3 = document.getElementById("id_LanIPAddr3").value & document.getElementById("id_DhcpNetmask3").value;
		var subnet_item4 = document.getElementById("id_LanIPAddr4").value & document.getElementById("id_DhcpNetmask4").value;
		var dhcp_subnet = subnet_item1+"."+subnet_item2+"."+subnet_item3+"."+subnet_item4;
		fvt_paramlist_cat_str('dhcp1_subnet', dhcp_subnet);

		var dnsserver_item1 = document.getElementById("id_DhcpDnsServer11").value;
		var dnsserver_item2 = document.getElementById("id_DhcpDnsServer12").value;
		var dnsserver_item3 = document.getElementById("id_DhcpDnsServer13").value;
		var dnsserver_item4 = document.getElementById("id_DhcpDnsServer14").value;
		var dhcp_dnsserver = dnsserver_item1+"."+dnsserver_item2+"."+dnsserver_item3+"."+dnsserver_item4;
		fvt_paramlist_cat_str('dhcp1_dns_server', dhcp_dnsserver);
		if( typeof meta_config['dhcp1_dns_server2'] !== 'undefined'){
			var dnsserver2_item1 = document.getElementById("id_DhcpDnsServer21").value;
			var dnsserver2_item2 = document.getElementById("id_DhcpDnsServer22").value;
			var dnsserver2_item3 = document.getElementById("id_DhcpDnsServer23").value;
			var dnsserver2_item4 = document.getElementById("id_DhcpDnsServer24").value;
			var dhcp_dnsserver2 = dnsserver2_item1+"."+dnsserver2_item2+"."+dnsserver2_item3+"."+dnsserver2_item4;
			if ( dhcp_dnsserver2 == "..." ) dhcp_dnsserver2="";
			fvt_paramlist_cat_str('dhcp1_dns_server2', dhcp_dnsserver2);
		}

		fvt_paramlist_cat_str("dhcp1_enable",  fvt_form_obj_get("lan2setting_form", "DHCPSEnable"));
		fvt_paramlist_cat_str('dhcp1_number_start', fvt_form_obj_get("lan2setting_form", "DHCPSIPStart"));
		fvt_paramlist_cat_str('dhcp1_number_end', fvt_form_obj_get("lan2setting_form", "DHCPSIPEnd"));
		fvt_paramlist_cat_str('dhcp1_leasetime', fvt_form_obj_get("lan2setting_form", "DHCPSLeaseTime"));

		//fvt_paramlist_cat_str('dhcp1_pool0_number_start', fvt_form_obj_get("lan2setting_form", "PoolIPStart4")); // ??
		//fvt_paramlist_cat_str('dhcp1_pool0_number_end', fvt_form_obj_get("lan2setting_form", "PoolIPEnd4")); // ??
		var eth_select=0;
		for ( i=1 ; i<=3 ; i++ )
		{
			var dev_br0="dev_br0_member_"+i;
			var dev_br1="dev_br1_member_"+i;
			var port_no= "id_eth"+(i+1)+"join";
			var eth_no="eth0."+(i+2);  // dev_br1_member_1 = id_eth2join = eth0.3
			if (document.getElementById(port_no).checked==true)
			{
				fvt_paramlist_cat_str(dev_br0, "");
				fvt_paramlist_cat_str(dev_br1, eth_no);
				eth_select=1;
			}
			else
			{
				fvt_paramlist_cat_str(dev_br0, eth_no);
				fvt_paramlist_cat_str(dev_br1, "");
			}
		}

		if (eth_select==1)
		{
			fvt_paramlist_cat_str('dev_lan1_interface', "br1");
			fvt_paramlist_cat_str('masq1_wan', "dev_wan0_interface");
			fvt_paramlist_cat_str('masq1_lan_ip1', "lan1_ip");
			fvt_paramlist_cat_str('masq1_lan_netmask1', "lan1_netmask");
		}
		else
		{
			fvt_paramlist_cat_str('dev_lan1_interface', "");
			fvt_paramlist_cat_str('masq1_wan', "dev_wan1_interface");
			fvt_paramlist_cat_str('masq1_lan_ip1', "lan0_ip");
			fvt_paramlist_cat_str('masq1_lan_netmask1', "lan0_netmask");
		}

	}
	fvt_paramlist_cat_str('dhcp1_dns_relay', fvt_form_obj_get("lan2setting_form", "DhcpDNSRelay"));
	fvt_paramlist_presubmit(form_name);
}

// Convert a subnet mask array into CIDR (# of bits) (255.255.255.0 = 24 etc.)
function octet2cidr(aMask) {
	var mask = octet2dec(aMask);
	// get binary string
	var mask_2 = parseInt(mask, 10).toString(2);
	// return mask length
	return mask_2.indexOf(0);
}
// Convert our array of 4 ints into a decimal (watch out for 16 bit JS integers here)
function octet2dec(a){
	var a_s = a.split(".");
	var d = 0;
	d = d + parseInt(a_s[0]) * 16777216 ;  //Math.pow(2,24);
	d = d + parseInt(a_s[1]) * 65536;	   //Math.pow(2,16);
	d = d + parseInt(a_s[2]) * 256;		   //Math.pow(2,8);
	d = d + parseInt(a_s[3]);
	return d;
}

function HEX2DEC(number) {
  // Return error if number is not hexadecimal or contains more than ten characters (10 digits)
  //if (!/^[0-9A-Fa-f]{1,10}$/.test(number)) return '#NUM!';
  if (!/^[0-9A-Fa-f]{1,10}$/.test(number)) return '';

  // Convert hexadecimal number to decimal
  var decimal = parseInt(number, 16);

  // Return decimal number
  return (decimal >= 549755813888) ? decimal - 1099511627776 : decimal;
}

function DEC2HEX(dec) {
  var buf = [],
  //map = '0123456789ABCDEF';
  map = '0123456789abcdef';
  while (parseInt(dec / 16, 10) !== 0) {
	buf.unshift(map[dec % 16]);
	dec = parseInt(dec / 16, 10);
  }
  buf.unshift(map[dec % 16]);
  return buf.join('');
};

function DEC2HEX_array(dec) {
	var result = DEC2HEX(dec);
	var result8 = result;
	var xout="";
	for (i = result.length ; i < 8; i++)
	{
		result8 = "0" + result8;
	}
	var hex_array = result8.match(/.{1,2}/g)
	for (i = 0 ; i <= 3; i++){xout = xout + "\\x" + hex_array[i];}
	return xout;
}

function BacktoLan()
{
	window.location.href="wwwctrl.cgi?action=lan_new";
}
//-->
</script>
</head>

<body align="left" onload="fvt_form_init('lan2setting_form'); dhcpChange(); check_process(); isBridgeMode();">
<div id="container">
<table align="center" width="90%"><tbody>
<tr><td valign="top">
<form id="lan2setting_form" name="lan2setting_form" method="post" action=>
<fieldset>
	<div class="lv1_title">Advanced Setup&nbsp;&gt;&nbsp;Second LAN Group Settings</div>
</fieldset>
<div class="div1_indent lv2_new">
<!--lan port grouping-->
	<div><hr class="hr2"></div>
	  <table><tbody>
		<tr>
			<td colspan="3">Select Ethernet port join Second LAN Group</td>
		</tr>

		<tr>
			<td>&nbsp;</td>
			<td>&nbsp;</td>
			<td>&nbsp;Ethernet port 1&nbsp;&nbsp;(Not allow to join Second LAN Group)</td>
		</tr>
		<tr>
			<td>&nbsp;</td>
			<td><input ctrlflip="etc" type="checkbox" name="eth2join" id="id_eth2join" onchange="Ethjoin(2)"></td>
			<td>&nbsp;Ethernet port 2</td>
		</tr>
		<tr>
			<td>&nbsp;</td>
			<td><input ctrlflip="etc" type="checkbox" name="eth3join" id="id_eth3join" onchange="Ethjoin(3)"></td>
			<td>&nbsp;Ethernet port 3</td>
		</tr>
		<tr>
			<td>&nbsp;</td>
			<td><input ctrlflip="etc" type="checkbox" name="eth4join" id="id_eth4join" onchange="Ethjoin(4)"></td>
			<td>&nbsp;Ethernet port 4</td>
		</tr>
	  </tbody></table>
	<div><hr class="hr2"></div>

<!--lan ip and mask-->
	  <table><tbody>
		<tr>
			<input name="lan_gateway" value="0.0.0.0" type="hidden">
			<input name="LanIPAddr" id="id_LanIPAddr" type="hidden">
			<td class="width_lanset1"><div ctrlflip="right" ctrlid="32">IP Address</div></td>
			<script language="javascript" type="text/javascript">
				var IP_Address = fvt_meta_config('lan1_ip');
				var IP_Address_split = IP_Address.split(".");
				document.write("<td ctrlflip='etc'><div dir=\"ltr\">");
				document.write("<input id=\"id_LanIPAddr1\" class=\"width_ip\" size=\"3\" maxlength=\"3\" value='"+IP_Address_split[0]+"' onkeyup=\"changedhcpIP(1)\" type=\"text\"> . ");
				document.write("<input id=\"id_LanIPAddr2\" class=\"width_ip\" size=\"3\" maxlength=\"3\" value='"+IP_Address_split[1]+"' onkeyup=\"changedhcpIP(2)\" type=\"text\"> . ");
				document.write("<input id=\"id_LanIPAddr3\" class=\"width_ip\" size=\"3\" maxlength=\"3\" value='"+IP_Address_split[2]+"' onkeyup=\"changedhcpIP(3)\" type=\"text\"> . ");
				document.write("<input id=\"id_LanIPAddr4\" class=\"width_ip\" size=\"3\" maxlength=\"3\" value='"+IP_Address_split[3]+"' type=\"text\">");
				document.write("</div></td>");
			</script>

			<input name="lan2_gateway" value="0.0.0.0" type="hidden">
			<input name="Lan2IPAddr" id="id_Lan2IPAddr" type="hidden">
			<td>&nbsp;&nbsp;&nbsp;</td>
			<td class="width_lanset1" style="display:none;"><div ctrlflip="right" ctrlid="32">Second IP Address</div></td>
			<script language="javascript" type="text/javascript">
				var IP_Address2 = fvt_meta_config('lan1_alias0_ip');
				if(IP_Address2 != "")
				{
					var IP_Address2_split = IP_Address2.split(".");
				}
				else
				{
					var IP_Address2_split = new Array();
					IP_Address2_split[0]="";
					IP_Address2_split[1]="";
					IP_Address2_split[2]="";
					IP_Address2_split[3]="";
				}
				document.write("<td ctrlflip='etc' style='display:none;'><div dir=\"ltr\">");
				document.write("<input id=\"id_Lan2IPAddr1\" class=\"width_ip\" size=\"3\" maxlength=\"3\" value='"+IP_Address2_split[0]+"' onkeyup=\"changedhcpIP(1)\" type=\"text\"> . ");
				document.write("<input id=\"id_Lan2IPAddr2\" class=\"width_ip\" size=\"3\" maxlength=\"3\" value='"+IP_Address2_split[1]+"' onkeyup=\"changedhcpIP(2)\" type=\"text\"> . ");
				document.write("<input id=\"id_Lan2IPAddr3\" class=\"width_ip\" size=\"3\" maxlength=\"3\" value='"+IP_Address2_split[2]+"' onkeyup=\"changedhcpIP(3)\" type=\"text\"> . ");
				document.write("<input id=\"id_Lan2IPAddr4\" class=\"width_ip\" size=\"3\" maxlength=\"3\" value='"+IP_Address2_split[3]+"' type=\"text\">");
				document.write("</div></td>");
			</script>
		</tr>
		<tr>
			<input name="LanNetmask" id="id_LanNetmask" type="hidden">
			<td nowrap=""><div ctrlflip="right" ctrlid="69">Subnet Mask</div></td>
			<script language="javascript" type="text/javascript">
				var Sub_Mask = fvt_meta_config('lan1_netmask');
				var Sub_Mask_split = Sub_Mask.split(".");
				document.write("<td ctrlflip='etc'><div dir=\"ltr\">");
				document.write("<input id=\"id_LanNetmask1\" class=\"width_ip\" size=\"3\" maxlength=\"3\" value='"+Sub_Mask_split[0]+"' type=\"text\"> . ");
				document.write("<input id=\"id_LanNetmask2\" class=\"width_ip\" size=\"3\" maxlength=\"3\" value='"+Sub_Mask_split[1]+"' type=\"text\"> . ");
				document.write("<input id=\"id_LanNetmask3\" class=\"width_ip\" size=\"3\" maxlength=\"3\" value='"+Sub_Mask_split[2]+"' type=\"text\"> . ");
				document.write("<input id=\"id_LanNetmask4\" class=\"width_ip\" size=\"3\" maxlength=\"3\" value='"+Sub_Mask_split[3]+"' type=\"text\">");
				document.write("</div></td>");
			</script>


			<input name="Lan2Netmask" id="id_Lan2Netmask" type="hidden">
			<td>&nbsp;&nbsp;&nbsp;</td>
			<td nowrap="" style="display:none;"><div ctrlflip="right" ctrlid="69">Second Subnet Mask</div></td>
			<script language="javascript" type="text/javascript">
				var Sub_Mask2 = fvt_meta_config('lan1_alias0_netmask');
				if(Sub_Mask2 != "")
				{
					var Sub_Mask2_split = Sub_Mask2.split(".");
				}
				else
				{
					var Sub_Mask2_split = new Array();
					Sub_Mask2_split[0]="";
					Sub_Mask2_split[1]="";
					Sub_Mask2_split[2]="";
					Sub_Mask2_split[3]="";
				}
				document.write("<td ctrlflip='etc' style='display:none;'><div dir=\"ltr\">");
				document.write("<input id=\"id_Lan2Netmask1\" class=\"width_ip\" size=\"3\" maxlength=\"3\" value='"+Sub_Mask2_split[0]+"' type=\"text\"> . ");
				document.write("<input id=\"id_Lan2Netmask2\" class=\"width_ip\" size=\"3\" maxlength=\"3\" value='"+Sub_Mask2_split[1]+"' type=\"text\"> . ");
				document.write("<input id=\"id_Lan2Netmask3\" class=\"width_ip\" size=\"3\" maxlength=\"3\" value='"+Sub_Mask2_split[2]+"' type=\"text\"> . ");
				document.write("<input id=\"id_Lan2Netmask4\" class=\"width_ip\" size=\"3\" maxlength=\"3\" value='"+Sub_Mask2_split[3]+"' type=\"text\">");
				document.write("</div></td>");
			</script>

			</tr>
	  </tbody></table>
	  <div><hr class="hr2"></div>

<!--dhcp server-->
	<table><tbody>
		<tr>
			<input ctrlflip='etc' name="nosave_DHCPSEnable" id="mm_DHCPSEnable" type="hidden">
			<td class="width_lanset1"><div	ctrlflip="right" ctrlid="75">DHCP Server</div></td>
			<td ctrlflip='etc'>
				<select ar='1' name="DHCPSEnable" id="id_DHCPSEnable" style="width:128px"  onchange="dhcpChange();">
					<option value='0'>Disable</option>
					<option value='1'>Enable</option>
					<!--<option value='2'>DHCP Relay</option>-->
				</select>
			</td>
		</tr>

		<script language="javascript" type="text/javascript">
			document.write("<tr id='dhcpServerTbl' "+valueMatch(DHCPSEnable, '2', 'style=\'display:none\'')+">");
		</script>
			<td><div ctrlflip='right' ctrlid="79">DHCP&nbsp;Starting&nbsp;IP&nbsp;Address</div></td>
			<input ctrlflip='etc' name="DHCPSIPStart" id="id_DHCPSIPStart" type="hidden">

			<script language="javascript" type="text/javascript">
				//var IP_Address = fvt_meta_config('lan1_ip');
				var IP_Address = fvt_meta_config('dhcp1_number_start');
				var IP_Address_split = IP_Address.split(".");
				//var DHCP_Start_IP_Address = fvt_meta_config('dhcp1_number_start');
				document.write("<td ctrlflip='right' ><div dir=\"ltr\">");
				document.write("<input id='id_DHCPSIPStart1' class='width_ip' size='3' maxlength='3' value='"+IP_Address_split[0]+"' type='text'>.");
				document.write("<input id='id_DHCPSIPStart2' class='width_ip' size='3' maxlength='3' value='"+IP_Address_split[1]+"' type='text'>.");
				document.write("<input id='id_DHCPSIPStart3' class='width_ip' size='3' maxlength='3' value='"+IP_Address_split[2]+"' type='text'>.");
				document.write("<input id='id_DHCPSIPStart4' class='width_ip' size='3' maxlength='3' value='"+IP_Address_split[3]+"' type='text' name='DHCPSIPStart4'>");
				//document.write("<input id='id_DHCPSIPStart4' name='DHCPSIPStart4' class='width_ip' size='3' maxlength='3' value='"+DHCP_Start_IP_Address+"' type='text'>");
				document.write("</div></td>");
			</script>
		</tr>

		<script language="javascript" type="text/javascript">
			document.write("<tr id='dhcpServerTb2' "+valueMatch(DHCPSEnable, '2', 'style=\'display:none\'')+" >");
		</script>
		<td><div ctrlflip='right' ctrlid="80">DHCP&nbsp;Ending&nbsp;IP&nbsp;Address</div></td>
		<input ctrlflip="etc" name="DHCPSIPEnd" id="id_DHCPSIPEnd" type="hidden">

		<script language="javascript" type="text/javascript">
			//var IP_Address = fvt_meta_config('lan1_ip');
			var IP_Address = fvt_meta_config('dhcp1_number_end');
			var IP_Address_split = IP_Address.split(".");
			//var DHCP_End_IP_Address = fvt_meta_config('dhcp1_number_end');
			document.write("<td ctrlflip='right'><div dir='ltr'>");
			document.write("<input id='id_DHCPSIPEnd1' class='width_ip' size='3' maxlength='3' value='"+IP_Address_split[0]+"' type='text'>.");
			document.write("<input id='id_DHCPSIPEnd2' class='width_ip' size='3' maxlength='3' value='"+IP_Address_split[1]+"' type='text'>.");
			document.write("<input id='id_DHCPSIPEnd3' class='width_ip' size='3' maxlength='3' value='"+IP_Address_split[2]+"' type='text'>.");
			document.write("<input id='id_DHCPSIPEnd4' class='width_ip' size='3' maxlength='3' value='"+IP_Address_split[3]+"' type='text' name='DHCPSIPEnd4'>");
			//document.write("<input id='id_DHCPSIPEnd4' name='DHCPSIPEnd4' class='width_ip' size='3' maxlength='3' value='"+DHCP_End_IP_Address+"' type='text'>");
			document.write("</div></td>");
		</script>
		</tr>
		<tr id="dhcpServerTb4" style="display:none">
			<input name="DhcpNetmask" id="id_DhcpNetmask" type="hidden">
			<td nowrap=""><div ctrlflip="right" ctrlid="69">DHCP Subnet Mask</div></td>
			<script language="javascript" type="text/javascript">
				var dhcp_Sub_Mask = fvt_meta_config('dhcp1_netmask');
				var dhcp_Sub_Mask_split = dhcp_Sub_Mask.split(".");
				document.write("<td ctrlflip='etc'><div dir=\"ltr\">");
				document.write("<input id=\"id_DhcpNetmask1\" class=\"width_ip\" size=\"3\" maxlength=\"3\" value='"+dhcp_Sub_Mask_split[0]+"' type=\"text\"> . ");
				document.write("<input id=\"id_DhcpNetmask2\" class=\"width_ip\" size=\"3\" maxlength=\"3\" value='"+dhcp_Sub_Mask_split[1]+"' type=\"text\"> . ");
				document.write("<input id=\"id_DhcpNetmask3\" class=\"width_ip\" size=\"3\" maxlength=\"3\" value='"+dhcp_Sub_Mask_split[2]+"' type=\"text\"> . ");
				document.write("<input id=\"id_DhcpNetmask4\" class=\"width_ip\" size=\"3\" maxlength=\"3\" value='"+dhcp_Sub_Mask_split[3]+"' type=\"text\">");
				document.write("</div></td>");
			</script>

		</tr>
		<tr id="dhcpDNSServerTb" style="display:none">
			<input name="DhcpDnsServer" id="id_DhcpDnsServer" type="hidden">
			<td nowrap=""><div ctrlflip="right" ctrlid="69">DHCP DNS Server</div></td>
			<script language="javascript" type="text/javascript">
				var dhcp_Dns_Server = fvt_meta_config('dhcp1_dns_server');
				var dhcp_Dns_Server_split = dhcp_Dns_Server.split(".");
				document.write("<td ctrlflip='etc'><div dir=\"ltr\">");
				document.write("<input id=\"id_DhcpDnsServer11\" class=\"width_ip\" size=\"3\" maxlength=\"3\" value='"+dhcp_Dns_Server_split[0]+"' type=\"text\"> . ");
				document.write("<input id=\"id_DhcpDnsServer12\" class=\"width_ip\" size=\"3\" maxlength=\"3\" value='"+dhcp_Dns_Server_split[1]+"' type=\"text\"> . ");
				document.write("<input id=\"id_DhcpDnsServer13\" class=\"width_ip\" size=\"3\" maxlength=\"3\" value='"+dhcp_Dns_Server_split[2]+"' type=\"text\"> . ");
				document.write("<input id=\"id_DhcpDnsServer14\" class=\"width_ip\" size=\"3\" maxlength=\"3\" value='"+dhcp_Dns_Server_split[3]+"' type=\"text\">");
				document.write("</div></td>");
			</script>

		</tr>
		<tr id="dhcpDNSServer2Tb" style="display:none">
			<input name="DhcpDnsServer2" id="id_DhcpDnsServer2" type="hidden">
			<td nowrap=""></td>
			<script language="javascript" type="text/javascript">
				var dhcp_Dns_Server2 = fvt_meta_config('dhcp1_dns_server2');
				if ( dhcp_Dns_Server2 == "" ) dhcp_Dns_Server2="..."
				var dhcp_Dns_Server2_split = dhcp_Dns_Server2.split(".");
				document.write("<td ctrlflip='etc'><div dir=\"ltr\">");
				document.write("<input id=\"id_DhcpDnsServer21\" class=\"width_ip\" size=\"3\" maxlength=\"3\" value='"+dhcp_Dns_Server2_split[0]+"' type=\"text\"> . ");
				document.write("<input id=\"id_DhcpDnsServer22\" class=\"width_ip\" size=\"3\" maxlength=\"3\" value='"+dhcp_Dns_Server2_split[1]+"' type=\"text\"> . ");
				document.write("<input id=\"id_DhcpDnsServer23\" class=\"width_ip\" size=\"3\" maxlength=\"3\" value='"+dhcp_Dns_Server2_split[2]+"' type=\"text\"> . ");
				document.write("<input id=\"id_DhcpDnsServer24\" class=\"width_ip\" size=\"3\" maxlength=\"3\" value='"+dhcp_Dns_Server2_split[3]+"' type=\"text\">");
				document.write("</div></td>");
			</script>

		</tr>
		<tr id="dhcpServerTb5" style="display:none">
			<td class="width_lanset1"><div ctrlflip="right" ctrlid="75">DHCP DNS Server :</div></td>
			<td><table><tr>
			<td><input type="radio" name="DhcpDNSRelay" id="id_DhcpDNSRelay" value="0" class="radio" onclick="option_dnsrelay()" checked>Proxy</td>
			<td>&nbsp;&nbsp;</td>
			<td><input type="radio" name="DhcpDNSRelay" id="id_DhcpDNSRelay" value="1" onclick="option_dnsrelay()" class="radio">Relay</td>
			</tr></table></td>
		</tr>
		<script language="javascript" type="text/javascript">
			document.write("<tr id='dhcpServerTb3' "+valueMatch(DHCPSEnable, '2', 'style=\'display:none\'')+" >");
		</script>
		<td><div ctrlflip="right" ctrlid="81">DHCP&nbsp;Lease&nbsp;Time</div></td>
		<td>
			<table><tr>
				<td><input ctrlflip='etc' name="DHCPSLeaseTime" class="width_textip" size="3" maxlength="6" type="text"></td>
				<td><div class="lv2_new suffix_lr" ctrlflip="etc" ctrlid="73">Seconds</div></td>
			</tr></table>
		</td>
	  </tr>
   </tbody></table>


  <div class="top_cwmp2">
	<table><tbody>
		<tr>
		<td></td>
			<td class="button_center">
				<input ctrlflip="etc" type="button" onclick="BacktoLan()" name="applybtn"  value="Back" class="width_apply" target="contentfrm">
				&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
				<input ctrlflip="etc" type="button" onclick="saveChanges()" name="applybtn"	 value="Apply Changes" class="width_apply">
			</td>
		<td></td>
		</tr>
	</tbody></table>
 </div>
</div>
</form>
</td></tr>
</tbody></table>
</div>

</body>
</html>

<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<link rel="stylesheet" type="text/css" href="../css/common.css" media="all">
<script language="javascript" type="text/javascript" src="../js/menu_base.js"></script>
<script language="javascript" type="text/javascript" src="../js/menu.js"></script>
<script language="javascript" type="text/javascript" src="../js/common.js"></script>
<script language="javascript" type="text/javascript" src="../js/fvt.js"></script>

<script language="javascript" type="text/javascript">
var specSymb = new Array("-","&",".","_","!","~","*","'","(",")","%","=","+","$",",","/","?");

var wan_max = 8;
function faceinter()
{
	var ifname;
	for (var k=0;k<wan_max;k++)
	{
		if(fvt_meta_config("wan"+k+"_if_name") != '')
		{
			ifname = fvt_meta_config("wan"+k+"_if_name");
			ifinter = fvt_meta_config("dev_wan"+k+"_interface");
			document.write("<option value='"+k+"'>"+ifinter+" ("+ifname+")</option>");
		}
	}
}

function check_syb(val,index)
{
        var c,i=0,j=0;
        for(i=0;i<val.length;i++)
        {
                c = val.charAt(i);
                if(!((c>='0' && c<='9')||(c>='a' && c<='z')||(c>='A' && c<='Z')))
                {
                        for (j=0;j<index;j++)
                        {
                                if (c==specSymb[j])
                                        break;
                        }
                        if (j==index)
                                return c;
                }
        }
        return "OK";
}

function valueMatch(s1, s2, match_return)
{
	if(s1 == s2)
		return match_return;
	else
		return "";
}

function check_baseinput(name, item, type)
{
	var syb;
	if (!isBlank(name))
    {
		if ((syb=check_syb(name,type))!="OK")
		{
			warn_CWMP_checkSyb(item,syb);
			//alert(item + " can't include special symbol ' " + syb + " '.");
	        return false;
		}
	}
	return true;
}
function check_specSymbol(name,item)
{
	if (!isBlank(name))
        {
		for(i=0;i<name.length;i++)
                {
                        c=name.charAt(i);
                        if(c=='"' || c=='{' ||c=='}' ||c=='|' ||c=="\\" ||c=='^' ||c=='~' ||c=='['
				|| c==']' || c=='`' || c=="#" || c=='<' || c=='>' || c==' ')
                        {
								warn_invalid(item);
                                //alert("The "  + item + " is invalid!");
                                return false;
                        }
                }
        }
        return true;
}
/*
function check_cwmpenable()
{
  if (document.getElementById("mm_CWMPModuleEnable").checked==true)
    document.getElementById("id_CWMPModuleEnable").value=1;
  else
    document.getElementById("id_CWMPModuleEnable").value=0;
}
*/

function result_clear(){
	fvt_paramlist_clear();
	fvt_paramlist_cat_str("result_cwmp_clear", "1");
	fvt_paramlist_presubmit("RemoteManagement_form");
	document.RemoteManagement_form.submit();
}

function apply()
{
	if (!check_specSymbol(document.RemoteManagement_form.CWMPAcsURL.value, "ACS URL"))
		return false;
	if (!check_baseinput(document.RemoteManagement_form.CWMPAcsUser.value, "ACServer User Name",17))
		return false;
	if (!check_baseinput(document.RemoteManagement_form.CWMPAcsPwd.value, "ACServer Password",15))
		return false;
	if (!check_baseinput(document.RemoteManagement_form.CWMPAcsReqUser.value, "Connection Request Username",17))
                return false;
        if (!check_baseinput(document.RemoteManagement_form.CWMPAcsReqPwd.value, "Connection Request Password",15))
                return false;

	//{Fanny add 2010.10.14
	if(fvt_meta_config('cwmp_dhcpopt43_enable')!=1)
	{
		string=document.RemoteManagement_form.CWMPAcsURL.value;
		re = /^http:\/\//;
		re2 = /^https:\/\//;
		if (string.length > 8)
		{
			if (!re.test(string)&&!re2.test(string))
			{
				warn_urlstring();
				//alert('It should be "http:// " or "https:// " at the beginning of URL.');
				return false;
			}
		}
		else if(!isStringOK(document.RemoteManagement_form.CWMPAcsURL.value))
		{
			warn_not_empty("ACS URL");
			return false;
		}
		else
		{
			warn_invalid("ACS URL");
			return false;
		}
		if(!isStringOK(document.RemoteManagement_form.CWMPAcsUser.value))
		{
			warn_not_empty("ACS User Name");
			return false;
		}
		if(!isStringOK(document.RemoteManagement_form.CWMPAcsPwd.value))
		{
			warn_not_empty("ACS Password");
			return false;
		}
	}
	if(!isStringOK(document.RemoteManagement_form.CWMPAcsInformInterval.value))
	{
		warn_not_empty("Inform Message Interval");
		return false;
	}
	if (!check_integer_range(document.RemoteManagement_form.CWMPAcsInformInterval.value, 30, 9999999999))
	{
		//alert("InformInterval should be an integer between 30 and 9999999999");
		warn_int_between("Inform Message Interval",30,9999999999);
		//alert("Inform Message Interval should be an integer between 30 and 9999999999");
		return false;
	}
	if(!isStringOK(document.RemoteManagement_form.CWMPAcsReqUser.value))
	{
		warn_not_empty("Connection Request Username");
		return false;
	}
	if(!isStringOK(document.RemoteManagement_form.CWMPAcsReqPwd.value))
	{
		warn_not_empty("Connection Request Password");
		return false;
	}

	//warn_apply();
	//alert("After applying changes, you shall reboot it.");
	fvt_form_submit('RemoteManagement_form','1');
	document.RemoteManagement_form.submit();
}
function cwmp_dhcp_enable()
{
	if(fvt_meta_config('cwmp_dhcpopt43_enable')==1)
	{
		document.getElementById('id_CWMPAcsURL').disabled=true;
		document.getElementById('id_CWMPAcsUser').disabled=true;
		document.getElementById('id_CWMPAcsPwd').disabled=true;
	}
}

function bootstrap_init()
{
	var bootmsg=fvt_meta_config('cwmp_boottrap_status');
	if(bootmsg=='0'){
		document.getElementById("id_boot_notice").value="供裝成功";
	}else if(bootmsg=='1'){
		document.getElementById("id_boot_notice").value="供裝失敗";
	}else  if(bootmsg=='2'){
		document.getElementById("id_boot_notice").value="網路異常";
	}else {
		document.getElementById("id_boot_notice").value="";
	}
	document.getElementById("id_boot_notice1").innerHTML = document.getElementById("id_boot_notice").value;
	document.getElementById("id_boot_notice1").style.visibility="visible"
}

function bootstrap()
{
	var cpe_deviceid_str;
	cpe_deviceid_str = fvt_form_obj_get("RemoteManagement_form", "CWMPCpeID1") +'-'+cpeid[1]+'-'+ fvt_form_obj_get("RemoteManagement_form", "CWMPCpeID2");
	fvt_paramlist_clear();
	fvt_paramlist_cat_str("cwmp_cpe_device_id", cpe_deviceid_str);
	fvt_paramlist_cat_str("cwmp_bootstrap", "1");
	fvt_paramlist_presubmit("RemoteManagement_form");
	document.RemoteManagement_form.submit();
}

function fvt_form_init(form_name)
{
	var cpe_deviceid_str;

	if (form_name=='RemoteManagement_form' || form_name=='*') {
		for (var k=0;k<wan_max;k++)
		{
			if(fvt_meta_config('cwmp_interface')=="dev_wan"+k+"_interface")
				fvt_form_obj_set("RemoteManagement_form", "CWMPInterface", k);
		}
		fvt_form_obj_set("RemoteManagement_form", "CWMPModuleEnable", fvt_meta_config('cwmp_enable'));		//hidden
		fvt_form_obj_set("RemoteManagement_form", "CWMPSystemEnable", fvt_meta_config('cwmp_enable'));
		fvt_form_obj_set("RemoteManagement_form", "CWMPAcsURL", fvt_meta_config('cwmp_acs_url'));		//text
		fvt_form_obj_set("RemoteManagement_form", "CWMPAcsUser", fvt_meta_config('cwmp_acs_username'));		//text
		fvt_form_obj_set("RemoteManagement_form", "CWMPAcsPwd", fvt_meta_config('cwmp_acs_password'));		//password
		fvt_form_obj_set("RemoteManagement_form", "CWMPAcsInformEnabled", fvt_meta_config('cwmp_acs_inform_enable'));		//select-one
		fvt_form_obj_set("RemoteManagement_form", "CWMPAcsInformInterval", fvt_meta_config('cwmp_acs_inform_interval'));		//text
		fvt_form_obj_set("RemoteManagement_form", "CWMPAcsReqUser", fvt_meta_config('cwmp_acs_request_username'));		//text
		fvt_form_obj_set("RemoteManagement_form", "CWMPAcsReqPwd", fvt_meta_config('cwmp_acs_request_password'));		//password

		//fvt_form_obj_set("RemoteManagement_form", "CWMPCpeManufacturer", fvt_meta_config('cwmp_cpe_manufactury'));		//text
		//fvt_form_obj_set("RemoteManagement_form", "CWMPCpeOui", fvt_meta_config('cwmp_cpe_oui'));		//text
		//fvt_form_obj_set("RemoteManagement_form", "CWMPCpeProductClass", fvt_meta_config('cwmp_cpe_product_class'));		//text
		//fvt_form_obj_set("RemoteManagement_form", "CWMPCpeSerialNum", fvt_meta_config('cwmp_cpe_sn'));		//text
	}
}

function fvt_form_submit(form_name,num) 	{
	var cpe_deviceid_str;

	fvt_paramlist_clear();
	if(num=='1'){
	if (form_name=='RemoteManagement_form' || form_name=='*') {
		var j = fvt_form_obj_get("RemoteManagement_form", "CWMPInterface");
		for (var k=0;k<wan_max;k++)
		{
			if(k==j)
				fvt_paramlist_cat_str('cwmp_interface', "dev_wan"+k+"_interface");
		}
		//fvt_paramlist_cat_str('cwmp_enable', fvt_form_obj_get("RemoteManagement_form", "CWMPModuleEnable"));		//hidden
		fvt_paramlist_cat_str('cwmp_enable', fvt_form_obj_get("RemoteManagement_form", "CWMPSystemEnable"));
		fvt_paramlist_cat_str('cwmp_acs_url', fvt_form_obj_get("RemoteManagement_form", "CWMPAcsURL"));		//text
		fvt_paramlist_cat_str('cwmp_acs_username', fvt_form_obj_get("RemoteManagement_form", "CWMPAcsUser"));		//text
		fvt_paramlist_cat_str('cwmp_acs_password', fvt_form_obj_get("RemoteManagement_form", "CWMPAcsPwd"));		//password
		fvt_paramlist_cat_str('cwmp_acs_inform_enable', fvt_form_obj_get("RemoteManagement_form", "CWMPAcsInformEnabled"));		//select-one
		fvt_paramlist_cat_str('cwmp_acs_inform_interval', fvt_form_obj_get("RemoteManagement_form", "CWMPAcsInformInterval"));		//text
		fvt_paramlist_cat_str('cwmp_acs_request_username', fvt_form_obj_get("RemoteManagement_form", "CWMPAcsReqUser"));		//text
		fvt_paramlist_cat_str('cwmp_acs_request_password', fvt_form_obj_get("RemoteManagement_form", "CWMPAcsReqPwd"));		//password

		cpe_deviceid_str =  fvt_form_obj_get("RemoteManagement_form", "CWMPCpeID1") +'-'+cpeid[1]+'-'+  fvt_form_obj_get("RemoteManagement_form", "CWMPCpeID2");
		fvt_paramlist_cat_str('cwmp_cpe_device_id', cpe_deviceid_str);
		//fvt_paramlist_cat_str('cwmp_cpe_manufactury', fvt_form_obj_get("RemoteManagement_form", "CWMPCpeManufacturer"));		//text
		//fvt_paramlist_cat_str('cwmp_cpe_oui', fvt_form_obj_get("RemoteManagement_form", "CWMPCpeOui"));		//text
		//fvt_paramlist_cat_str('cwmp_cpe_product_class', fvt_form_obj_get("RemoteManagement_form", "CWMPCpeProductClass"));		//text
		//fvt_paramlist_cat_str('cwmp_cpe_sn', fvt_form_obj_get("RemoteManagement_form", "CWMPCpeSerialNum"));		//text
		// remove it due to change CPE ID will auto Inform (Event code = 0 BOOTSTRAP, M BOOTSTRAP BUTTON)
		//fvt_paramlist_cat_str("cwmp_bootstrap", "1");
	}
	}else if(num=='2'){
		fvt_paramlist_cat_str('cwmp_bootstrap', "bootstrap");
		//fvt_paramlist_cat_str('bootstrap', "1");
	}
	fvt_paramlist_presubmit(form_name);
}
</script>
</head>

<body align="left" onload="fvt_form_init('RemoteManagement_form');cwmp_dhcp_enable();bootstrap_init()">
<div id="container">
<table align="center" width="90%"><tbody>
<tr><td valign="top">
<form id="RemoteManagement_form" name="RemoteManagement_form" method="post">
	<fieldset>
		<div class="lv1_title">Maintenance&nbsp;&gt;&nbsp;Utilities&nbsp;&gt;&nbsp;TR069 Management</div>
	</fieldset>

	<div class="div1_indent">
		<div class="lv2_new" >
			<div>
	          <table>
				<tr><td><div ctrlflip="right" ctrlid="332">Enable TR-069</div></td>
					<td><select ar='1' name="CWMPSystemEnable" class="width_cwmp">
							<option value=0>Disable</option>
							<option value=1>Enable</option>
						</select>
					</td>
				</tr>
				<tr><td><div ctrlflip="right" ctrlid="332">Interface</div></td>
					<td><select ar='1' name="CWMPInterface" class="width_cwmp">
						<script>
							faceinter();
						</script>
						</select>
					</td>
				</tr>
				<tr><td><div ctrlflip="right" ctrlid="336">CHT&nbsp;CPE&nbsp;ID:</div></td>
					<td>
						<script>
						cpe_deviceid_str=fvt_meta_config("cwmp_cpe_device_id");
						if (cpe_deviceid_str != '')
						{
							var cpeid = cpe_deviceid_str.split("-");
						}
						else
						{
							var cpeid = new Array();
							cpeid[0] = '';
							cpeid[1] = '';
							cpeid[2] = '';
						}
						document.write("<input ctrlflip='etc' type='text' size='9' maxlength='9' name='CWMPCpeID1' value='"+cpeid[0]+"'>-"+cpeid[1]+"-");
						document.write("<input ctrlflip='etc' type='text' size='4' maxlength='4' name='CWMPCpeID2' value='"+cpeid[2]+"'>");
						</script>
					</td>
				</tr>
				<tr><td><div ctrlflip="right" ctrlid="337">Bootstrap:</div></td>
					<td><input ctrlflip="etc" type="button" class="width_cwmp" name="CWMPBootTrap" value="Bootstrap" onclick="bootstrap();"></td>
				</tr>
				<tr><td><div ctrlflip="right" ctrlid="332">Inform</div></td>
					<td><select ar='1' name="CWMPAcsInformEnabled" class="width_cwmp">
							<option value=0>Disable</option>
							<option value=1>Enable</option>
						</select>
					</td>
				</tr>
				<tr><td><div ctrlflip="right" ctrlid="333">Inform&nbsp;Interval(s)</div></td>
					<td><input type="text" class="width_cwmp" name="CWMPAcsInformInterval"></td>
				</tr>

<!--
				<tr style="display:none"><td class="width_cwmp"><div ctrlflip="right" ctrlid="240">Enable</div></td>
					<td>
						<script language="javascript" type="text/javascript">
							document.write("<table><tr><td><input disabled=\"disabled\" name=\"CWMPModuleEnable\" id=\"id_CWMPModuleEnable\" type=\"hidden\"></td>");
							document.write("<td><input id=\"mm_CWMPModuleEnable\" class='checkbox' onclick='check_cwmpenable();' "+valueMatch(fvt_meta_config('cwmp_enable'), '1', 'checked')+" type=\"checkbox\"></td></tr></table>");
						</script>
					</td>
				</tr>
-->
				<tr><td class="width_cwmp"><div ctrlflip="right" ctrlid="329">ACS&nbsp;URL</div></td>
					<td><input ctrlflip="etc" type="text" id='id_CWMPAcsURL' class="width_cwmp" name="CWMPAcsURL"></td>
				</tr>
				<tr><td><div ctrlflip="right" ctrlid="330">ACS&nbsp;User&nbsp;Name</div></td>
					<td><input ctrlflip="etc" type="text" maxlength='32' id='id_CWMPAcsUser' class="width_cwmp" name="CWMPAcsUser"></td>
				</tr>
				<tr><td><div ctrlflip="right" ctrlid="331">ACS&nbsp;Password</div></td>
					<td><input ctrlflip="etc" type="text" maxlength='32' id="id_CWMPAcsPwd" class="width_cwmp" name="CWMPAcsPwd"></td>
				</tr>
			<!--	<tr><td width="250"><div ctrlflip="right" ctrlid="331">WAN&nbsp;Interface&nbsp;used&nbsp;by&nbsp;TR-069&nbsp;client:</div></td>
					<td><div ctrlflip="right" ctrlid="331">ptm0_4</div></td>
				</tr>-->

				<tr><td><div ctrlflip="right" ctrlid="334">Connection&nbsp;Request&nbsp;Username</div></td>
					<td><input ctrlflip="etc" type="text" maxlength='32' class="width_cwmp" name="CWMPAcsReqUser"></td>
				</tr>
				<tr><td><div ctrlflip="right" ctrlid="335">Connection&nbsp;Request&nbsp;Password</div></td>
					<td><input ctrlflip="etc" type="text" maxlength='32' class="width_cwmp" name="CWMPAcsReqPwd"></td>
				</tr>
				<tr>
					<td>
						<input type="hidden" name="boot_notice" id="id_boot_notice" value="">
						<font size="5"  color="red">
						<div ctrlflip="right" ctrlid="337" name="boot_notice1" id="id_boot_notice1" style="visibility:hidden">test</div>
						</font>

					</td>
					<td><input ctrlflip='etc' type='button' onclick='result_clear();' name='clearbtn'  value='Clear result' class='width_cwmp'></td>

				</tr>

<!--
				<tr><td><div ctrlflip="right" ctrlid="336">CPE&nbsp;Manufacturer</div></td>
					<td><input ctrlflip="etc" disabled="disabled" type="text" class="width_cwmp" name="CWMPCpeManufacturer"></td>
				</tr>
				<tr><td><div ctrlflip="right" ctrlid="337">CPE&nbsp;OUI</div></td>
					<td><input ctrlflip="etc" disabled="disabled" type="text" class="width_cwmp" name="CWMPCpeOui"></td>
				</tr>
				<tr><td><div ctrlflip="right" ctrlid="338">CPE&nbsp;Product&nbsp;Class</div></td>
					<td><input ctrlflip="etc" disabled="disabled" type="text" class="width_cwmp" name="CWMPCpeProductClass"></td>
				</tr>
				<tr><td><div ctrlflip="right" ctrlid="339">CPE&nbsp;Serial&nbsp;Number</div></td>
					<td><input ctrlflip="etc" disabled="disabled" type="text" class="width_cwmp" name="CWMPCpeSerialNum"></td>
				</tr>
				-->
			</table>
		</div>
	</div>
	</div>
	<div class="top_cwmp2">
		<table>
			<tr>
				<td class="button_center">
					<input ctrlflip="etc" type="button" onclick="apply();" name="applybtn"  value="Apply Changes" class="width_apply">
				</td>
			</tr>
		</table>
	</div>
</form>
</td></tr>
</tbody></table>
</div>

<br>
</body>
</html>






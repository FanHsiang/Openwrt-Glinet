<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<link rel="stylesheet" type="text/css" href="../css/common.css" media="all">
<script language="javascript" type="text/javascript" src="../js/menu_base.js"></script>
<script language="javascript" type="text/javascript" src="../js/menu.js"></script>
<script language="javascript" type="text/javascript" src="../js/common.js"></script>
<script language="javascript" type="text/javascript" src="../js/fvt.js"></script>


<script language="javascript" type="text/javascript">
var ruleNum=0;
var maxrule=12;
var edit_num=99;
function check_process()
{    
	var process="Success";
	if (process=="Existed")
		alert("Please wait!!Another client is upgading firmware.");
}

function deleteRule(val)
{
	document.getElementById("id_delete_item").value=val;	
	fvt_form_submit('tbl_form');
    document.getElementById("id_ARP_tbl_form").submit();
}

function editRule(val)
{
	edit_num=val;
	document.getElementById("id_edit_item").value=val;
	var arp_mac=document.getElementById("id_tblMac_" + val).value;
	var arp_mac_spilt=arp_mac.split(":");
	for (var i=1,j=1;i<=6;i+=2,j++)
	{
		document.getElementById("id_arpMAC_"+j).value=arp_mac_spilt[i-1]+arp_mac_spilt[i];
	}
	//document.getElementById("id_arpMAC").value = document.getElementById("id_tblMac_" + val).value;

	var arp_ip=document.getElementById("id_tblIP_"+val).value;
	var arp_ip_spilt=arp_ip.split(".");
	for (i=1;i<=4;i++)
		document.getElementById("id_arpIP_"+i).value=arp_ip_spilt[i-1];
	document.arp_setting_form.submitBtn.disabled=false;
}
function enableRule(index)
{
	fvt_paramlist_clear();
	
	if(document.getElementById("id_arp_en_"+index).value=="Enable")
	{
		fvt_paramlist_cat_str("arp_static_en_"+index,1);
	}
	else
	{	
		 fvt_paramlist_cat_str("arp_static_en_"+index,0);
	}

	fvt_paramlist_presubmit("tbl_form");
    document.getElementById("id_ARP_tbl_form").submit();	
}

function init()
{
	if (ruleNum>=maxrule)
		document.arp_setting_form.submitBtn.disabled=true;
}
function check_symbol(name) 
{ 
	if (!isBlank(name)) 
	{ 
 		for(i=0;i<name.length;i++) 
 		{ 
  			c=name.charAt(i); 
  			if((c!='_')&&(c!='-')&&(c!='.')&&(!((c>='a')&&(c<='z')))&&(!((c>='A')&&(c<='Z')))&&(!((c>='0')&&(c<='9')))) 
  				return false; 
  		} 
 	} 
	return true; 
}
function check_conflict() 
{ 
	var newMAC=document.getElementById("id_arpMAC").value;
	var newIP=document.getElementById("id_arpIP").value;
	/*
	var newIP1=document.getElementById("id_DNSServerName1").value;
	var newIP2=document.getElementById("id_DNSServerName2").value;
	var newIP3=document.getElementById("id_DNSServerName3").value;
	var newIP4=document.getElementById("id_DNSServerName4").value;
	*/
	var ruleMac,ruleIP1,ruleIP2,ruleIP3,ruleIP4;
	var ruleIP;
	for(i=0;i<ruleNum;i++)
	{
		if (edit_num!=i)
		{
			ruleMac=document.getElementById("id_tblMac_"+i).value;
			ruleIP=document.getElementById("id_tblIP_"+i).value;
			/*
			ruleIP1=document.getElementById("id_tblser"+i+"_1").value;
			ruleIP2=document.getElementById("id_tblser"+i+"_2").value;
			ruleIP3=document.getElementById("id_tblser"+i+"_3").value;
			ruleIP4=document.getElementById("id_tblser"+i+"_4").value;
			*/
			if (newMAC==ruleMac || newIP==ruleIP )
				return false; 
			/*
			if (newIP1==ruleIP1 && newIP2==ruleIP2 && newIP3==ruleIP3 &&newIP4==ruleIP4)
				return false;
			*/
		}		
		
	}
	return true; 
}
function setARP()
{
	var item;
	var i, j;
	merge_mac("id_arpMAC","id_arpMAC_1","id_arpMAC_2","id_arpMAC_3","id_arpMAC_4","id_arpMAC_5","id_arpMAC_6");
	merge_ip("id_arpIP","id_arpIP_1","id_arpIP_2","id_arpIP_3","id_arpIP_4");
	
	if ((!check_mac(document.getElementById("id_arpMAC").value)) || (document.getElementById("id_arpMAC").value.length==0))
	{
		item="MAC Address";
                alert("The "  + item + " is invalid!")
		return false;
	}
	else if (!check_ip(document.getElementById("id_arpIP").value) ||
	document.getElementById("id_arpIP").value.length==0)
	{
		item="IP Address";
                alert("The "  + item + " is invalid!")
		return false;		
	}

	if (!check_conflict())
	{
		alert("The new rule is conflicted with current rules.")
		return false;	
	}
	fvt_form_submit('arp_setting_form');
	document.getElementById("id_arp_setting_form").submit();
}


function fvt_form_init(form_name) 
{
	if (form_name=='arp_setting_form' || form_name=='*') {
		//fvt_form_obj_set("arp_setting_form", "nosave_DNSDomain", fvt_meta_config(''));		//text
		//fvt_form_obj_set("arp_setting_form", "nosave_arpTargetIP", fvt_meta_config(''));		//hidden
	} else if (form_name=='tbl_form' || form_name=='*') {
		//fvt_form_obj_set("tbl_form", "nosave_deleteEntry", fvt_meta_config(''));		//hidden
		for(ruleNum=0; ruleNum < maxrule; ruleNum++)
		{
			var doname_var = fvt_meta_config("arp_static_mac_"+ruleNum);			
			if (doname_var == '')
			{
				return;
			}
		}
	}
}

function list_arp_setting()
{
	fvt_form_init('tbl_form');
	for (var i=0; i<ruleNum; i++)
	{
		if(i%2 == 0)
			document.write("<tr class='color_rowh'>");
		else
			document.write("<tr class='color_rown'>");

		document.write("<td ctrlflip='right'><input type='hidden' id='id_tblMac_"+i+"' value='"+fvt_meta_config("arp_static_mac_"+i)+"'>"+format_mac6to3(fvt_meta_config("arp_static_mac_"+i))+"</td>");
		document.write("<td ctrlflip='right'><input type='hidden' id='id_tblIP_"+i+"' value='"+fvt_meta_config("arp_static_ip_"+i)+"'>"+fvt_meta_config("arp_static_ip_"+i)+"</td>");
		document.write("<td><input ctrlflip='etc' type='button' name='nosave_editEntry' value='Edit' class='width_arpentry_edit' onclick='editRule(\""+i+"\");' ></td>");
        document.write("<td><input ctrlflip='etc' type='button' name='nosave_deleteEntry' value='Delete' class='width_arpentry_del' onclick='deleteRule(\""+i+"\");' ></td>");
		if(fvt_meta_config("arp_static_en_"+i)==1)
			document.write("<td><input ctrlflip='etc' id='id_arp_en_"+i+"' type='button' name='nosave_enable' value='Disable' class='width_arpentry_enable' onclick='enableRule(\""+i+"\");' ></td>");
		else if(fvt_meta_config("arp_static_en_"+i)==0)
			document.write("<td><input ctrlflip='etc' id='id_arp_en_"+i+"' type='button' name='nosave_enable' value='Enable' class='width_arpentry_enable' onclick='enableRule(\""+i+"\");' ></td>");
		document.write("</tr>");
	}
}
function fvt_form_submit(form_name) 	
{
	fvt_paramlist_clear();
	if (form_name=='arp_setting_form' || form_name=='*') {	
		if (edit_num != 99)
		{
			fvt_paramlist_cat_str("arp_static_mac_"+edit_num, fvt_form_obj_get("arp_setting_form", "nosave_arpTargetMAC"));		//text
			fvt_paramlist_cat_str("arp_static_ip_"+edit_num, fvt_form_obj_get("arp_setting_form", "nosave_arpTargetIP"));	
			fvt_paramlist_cat_str("arp_static_en_"+edit_num, 1);	
			edit_num=99;
		}
		else
		{			
			fvt_paramlist_cat_str("arp_static_mac_"+ruleNum, fvt_form_obj_get("arp_setting_form", "nosave_arpTargetMAC"));		//text
			fvt_paramlist_cat_str("arp_static_ip_"+ruleNum, fvt_form_obj_get("arp_setting_form", "nosave_arpTargetIP"));
			fvt_paramlist_cat_str("arp_static_en_"+ruleNum, 1);	
		}
	} else if (form_name=='tbl_form' || form_name=='*') {
		var del_num=document.getElementById("id_delete_item").value;	
		var j=0;
		for (var i=0; i< maxrule; i++)
		{
			if (j < ruleNum)
			{
				if(i == del_num)
				{
					j++;
					if( del_num == ruleNum-1 )
					{
						fvt_paramlist_cat_str("arp_static_mac_"+i, "");		//text
						fvt_paramlist_cat_str("arp_static_ip_"+i, "");
						fvt_paramlist_cat_str("arp_static_en_"+i, "");
					}
					else
					{						
						fvt_paramlist_cat_str("arp_static_mac_"+i, document.getElementById("id_tblMac_"+j).value);		//text
						fvt_paramlist_cat_str("arp_static_ip_"+i, document.getElementById("id_tblIP_"+j).value);	
						fvt_paramlist_cat_str("arp_static_en_"+i,( document.getElementById("id_arp_en_"+j).value == "Enable"?0:1));	
					}
				}
				else if(i==(ruleNum-1))
				{
					fvt_paramlist_cat_str("arp_static_mac_"+i, "");		//text
					fvt_paramlist_cat_str("arp_static_ip_"+i, "");
					fvt_paramlist_cat_str("arp_static_en_"+i, "");
				}
				else
				{
					fvt_paramlist_cat_str("arp_static_mac_"+i, document.getElementById("id_tblMac_"+j).value);		//text
					fvt_paramlist_cat_str("arp_static_ip_"+i, document.getElementById("id_tblIP_"+j).value);
					fvt_paramlist_cat_str("arp_static_en_"+i,( document.getElementById("id_arp_en_"+j).value == "Enable"?0:1));	
				}
				j++;
			}
			else 
			{
				fvt_paramlist_cat_str("arp_static_mac_"+i, "");		//text
				fvt_paramlist_cat_str("arp_static_ip_"+i, "");
				fvt_paramlist_cat_str("arp_static_en_"+i, "");
			}
		}
	}

	fvt_paramlist_presubmit(form_name);
}
</script>
</head>

<body align="left" onload="fvt_form_init('tbl_form');check_process();init();">
<div id="container">
<table align="center" width="90%"><tbody>
<tr><td valign="top">
<form id="id_arp_setting_form" name="arp_setting_form" method="post">	
	<fieldset>
		<div class="lv1_title">Advanced Setup&nbsp;&gt;&nbsp;Static ARP Entry</div>
	</fieldset>	
<div class="div1_indent lv2_new">
	<div><hr class="hr2" /></div>	
	<input name="nosave_editEntry" id="id_edit_item" value="0" type="hidden">
	<div>
		<table><tbody>
			<tr>
				<td class="width_arpentry1"><div ctrlflip="right" ctrlid="44">MAC Address</div></td>
				<td ctrlflip="right">
					<input name="nosave_arpTargetMAC" id="id_arpMAC" value="" type="hidden">
					<input id="id_arpMAC_1" class="width_mac" size="2" maxlength="2" type="text"> :
					<input id="id_arpMAC_2" class="width_mac" size="2" maxlength="2" type="text"> :
					<input id="id_arpMAC_3" class="width_mac" size="2" maxlength="2" type="text"> :
					<input id="id_arpMAC_4" class="width_mac" size="2" maxlength="2" type="text"> :
					<input id="id_arpMAC_5" class="width_mac" size="2" maxlength="2" type="text"> :
					<input id="id_arpMAC_6" class="width_mac" size="2" maxlength="2" type="text">
				</td>
			</tr>			
			<tr><td>&nbsp;</td></tr>
			<tr>
				<td><div ctrlflip="right" ctrlid="32">IP Address</div></td>
				<td ctrlflip="right">
					<input name="nosave_arpTargetIP" id="id_arpIP" value="" type="hidden">
					<input id="id_arpIP_1" class="width_ip" size="2" maxlength="3" type="text"> .
					<input id="id_arpIP_2" class="width_ip" size="2" maxlength="3" type="text"> .
					<input id="id_arpIP_3" class="width_ip" size="2" maxlength="3" type="text"> .
					<input id="id_arpIP_4" class="width_ip" size="2" maxlength="3" type="text">
				</td>
			</tr>
			<tr><td>&nbsp;</td></tr>
			<tr><td></td>
				<td>
					<input ctrlflip="etc" id="add_applybtn" name="submitBtn" type="button" value="Add" class="width_button" onclick="setARP();">
				</td>
			</tr>
		</tbody></table>
		<div> <hr class="hr2" /></div>
	</div>
</div>
</form>
<form id="id_ARP_tbl_form" name="tbl_form" method="post">
<div class="bottom_arpentry2 lv2_new">	
	<input name="nosave_deleteEntry" id="id_delete_item" value="0" type="hidden">	
	<div class="div1_topbottom lv2_new" ctrlflip="right" ctrlid="103">Overview</div>
	<div class="div2_indent ">
		<table><tbody>				
			<tr>
				<th class="width_arpentry_mac"><div class="lv2_new" ctrlflip="right" ctrlid="44">MAC Address</div></th>
				<th class="width_arpentry_ip"><div class="lv2_new" ctrlflip="right" ctrlid="32">IP Address</div></th>				
			</tr>
			<tr style="height:5px;">
				<td colspan="9">
					<div><hr class="hr2"></div>
				</td>
			</tr>
			<script language="javascript" type="text/javascript">
				list_arp_setting();
			</script>
		</tbody></table>
	</div>
</div>
</form>
</td></tr>	
</tbody></table>
</div>

<br>		
</body>
</html>





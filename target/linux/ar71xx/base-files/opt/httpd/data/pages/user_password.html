<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<link rel="stylesheet" type="text/css" href="../css/common.css" media="all">
<link href="../css/zycss.css" rel="stylesheet" type="text/css" />
<script language="javascript" type="text/javascript" src="../js/menu_base.js"></script>
<script language="javascript" type="text/javascript" src="../js/menu.js"></script>
<script language="javascript" type="text/javascript" src="../js/common.js"></script>
<script language="javascript" type="text/javascript" src="../js/fvt.js"></script>

<script language="javascript" type="text/javascript">
//var userLang = navigator.language || navigator.userLanguage;
var NavLang=GetNavLang();

if (NavLang == "ZH")
{
var vChangePW = "變更密碼";
var vUsername = "使用者名稱:";
var vPWold = "舊密碼";
var vPWNew = "新密碼";
var vPWConfirm = "確認新密碼";
var vPWNote = "Note： 請記下更改後的新密碼，如果忘記密碼將無法進入系統中";
var vSave = "儲存";
}
else
{
var vChangePW = "Change Password";
var vUsername = "Username:";
var vPWold = "Old Password";
var vPWNew = "New Password";
var vPWConfirm = "Confirm New Password";
var vPWNote = "Note: Please remember your new password, login will be denied if you forget the new password.";
var vSave = "Save";
}

var maxWan=8;

function check_process()
{
	var process="Success";
	if (process=="Existed")
		alert("Please wait!! Another client is upgading firmware.");
}

function check_password(name)
{
	if (!isBlank(name))
	{
		for(i=0;i<name.length;i++)
		{
			c=name.charAt(i);
			if((c!='_')&&(c!='-')&&(c!=' ')&&(!((c>='a')&&(c<='z')))&&(!((c>='A')&&(c<='Z')))&&(!((c>='0')&&(c<='9'))))
			{
			//	alert(" New Password should be 'a' ~ 'z', 'A' ~ 'Z', '_', '-' ,' ' and '0' ~ '9'");
				alert("New Password should be 'a' ~ 'z', 'A' ~ 'Z', '_', '-', ' ' and '0' ~ '9'");
				return false;
			}
		}
	}
	return true;
}

function checkEmpty(string, name)
{
	if(string == "")
	{
		//alert(name + " is empty");
		alert(name + " is empty");
		return false;
	}

	return true;
}

function enableAllItem()
{
	var i=0;
	for (i=0;i<document.pwd_setting.elements.length-11;i++)
		document.pwd_setting.elements[i].disabled = false;
	document.pwd_setting.elements[8].disabled = true;
}

function checkGUI(num, index)
{
	var i;
	var field_name2 = new Array ( "User Password", "User New Password", "User Password Confirmation" );
	var item1=document.getElementById("currentpassword"+index);
	var item2=document.getElementById("newpassword"+index);
	var item3=document.getElementById("renewpassword"+index);

	var chk_flag="1";
	if( (item1.value.length != 0) && (item2.value.length != 0)&& (item3.value.length != 0) )
	{
		if (item2.value == item3.value)
		{
			item3.disabled=true;
			if (!check_password(item2.value))
			{
				item3.disabled=false;
				return false;
			}
			return true;
		}
		else
		{
			var item="GUI Settings";
			alert("Confirm new password error or new password is empty!");
			return false;
		}
	}
	else if( (item1.value.length == 0) && (item2.value.length == 0)&& (item3.value.length == 0) )
	{
		item1.disabled = true;
		item2.disabled = true;
		item3.disabled = true;

		return true;
	}
	else
	{
		for(i=0; i<3; i++)
		{
			if (index=='2')
			{
				if(num==1)
				{
					if (chk_flag=="0" && i==1)
						i++;

					if(!checkEmpty(document.pwd_setting.elements[i].value, field_name2[i]))
						return false;
				}
				else
				{
					if(!checkEmpty(document.pwd_setting.elements[i+5].value, field_name2[i]))
						return false;
				}
			}
			else
			{
				if(!checkEmpty(document.pwd_setting.elements[i+2].value, field_name[i]))
					return false;
			}
		}
	}
	return true;
}

function checkPWD()
{

	if (!checkGUI(2,'2'))
	{
		enableAllItem();
		return false;
	}
	fvt_form_submit('pwd_setting');
	document.pwd_setting.submit();
}


function fvt_form_submit(form_name)		{
	fvt_paramlist_clear();
	if (form_name=='pwd_setting' || form_name=='*') {
		fvt_paramlist_cat_str('kv_user_curpwd', fvt_form_obj_get("pwd_setting", "currentpassword2"));		//password
		fvt_paramlist_cat_str('kv_user_newpwd', fvt_form_obj_get("pwd_setting", "newpassword2"));		//password
		fvt_paramlist_cat_str('kv_user_renewpwd', fvt_form_obj_get("pwd_setting", "renewpassword2"));		//password
		fvt_paramlist_cat_str('kv_remote_ip_k', fvt_meta_config('kv_remote_ip'));
	}
	fvt_paramlist_presubmit(form_name);
}

function check_passwd()
{
	var check1=fvt_meta_config('password_user_check');
	if(check1=="false")
	{
		alert("Your current user password is error, please check it and try again.");
		return false;
	}
}

</script>
</head>

<body align="left" onload="check_process();">
<div id="container">
<table align="center" width="90%"><tbody>
<tr><td valign="top">
<form id="pwd_setting" name="pwd_setting" method="post">
	<fieldset>
		<div class="lv1_title">
		<script language="javascript" type="text/javascript">
			document.write("Maintenance&nbsp;&gt;&nbsp;"+vChangePW);
		</script>
		</div>
	</fieldset>

<div class="div1_indent">
   <div>
	<div><hr class="hr2"></div>
	<div class="lv2_new div2_indent" >
		<table>
			<tr><td width="200px"><div ctrlflip="right" ctrlid="294">
			<script language="javascript" type="text/javascript">
				document.write(vUsername);
			</script>
			</div></td>
				<td><div>user</div></td>
			</tr>
			<tr><td><div ctrlflip="right" ctrlid="294">
			<script language="javascript" type="text/javascript">
				document.write(vPWold);
			</script>
			</div></td>
				<td><input ctrlflip="etc" type="password" class="utilpassword" name="currentpassword2" id="currentpassword2"></td>
			</tr>
			<tr><td><div ctrlflip="right" ctrlid="295">
			<script language="javascript" type="text/javascript">
				document.write(vPWNew);
			</script>
			</div></td>
				<td><input ctrlflip="etc" type="password" class="utilpassword" name="newpassword2" id="newpassword2"></td>
			</tr>
			<tr><td><div ctrlflip="right" ctrlid="296">
			<script language="javascript" type="text/javascript">
				document.write(vPWConfirm);
			</script>
			</div></td>
				<td><input ctrlflip="etc" type="password" class="utilpassword" name="renewpassword2" id="renewpassword2"></td>
			</tr>
		</table>
	</div>
	<div class="warning">
		<div class="title">
			<script language="javascript" type="text/javascript">
				document.write(vPWNote);
			</script>
		</div>
	</div>

	<div class="top_cwmp2">
		<table>
			<tr>
				<td class="button_center">
				<!-- <input ctrlflip="etc" type="submit" onclick="checkPWD();" name="applybtn"  value="儲存" class="btnstyle"><td> -->
				<script language="javascript" type="text/javascript">
					document.write("<input ctrlflip='etc' type='submit' onclick='checkPWD();' ");
					document.write("name='applybtn' class='btnstyle' value='"+vSave+"' >");
				</script>
			</tr>
		</table>
	</div>
</div>
</form>
</td></tr>
</tbody></table>
</div>
<br>
</body>
</html>

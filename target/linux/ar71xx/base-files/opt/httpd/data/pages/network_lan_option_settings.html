<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<link rel="stylesheet" type="text/css" href="../css/common.css" media="all">
<script language="javascript" type="text/javascript" src="../js/menu_base.js"></script>
<script language="javascript" type="text/javascript" src="../js/menu.js"></script>
<script language="javascript" type="text/javascript" src="../js/common.js"></script>
<script language="javascript" type="text/javascript" src="../js/fvt.js"></script>

<script language="javascript" type="text/javascript">

var OPTN_Rule=URLParams("opt");
var DHCPSEnable;
var DhcpRelayEnable;

var i=0;
var max_option=4;
var DHCPenable=0,DHCP_s=0,DHCP_e=0;
// #16-18: pool0, #19-21: pool1, #22-24: pool2, #25-27: pool3
var meta_opt_base = 16 + (parseInt(OPTN_Rule)*3);
var meta_opt60  = meta_opt_base;
var meta_opt61  = meta_opt_base+1;
var meta_opt125 = meta_opt_base+2;

function check_process()
{
	var process="Success";
	if (process=="Existed")
		alert("Please wait!!");
}

function checkRelayVenderId()
{
	if (document.getElementById("id_DHCPSRelayServer2VID").value.length==0)
	{
		var item="Mapping Vender ID";
		warn_not_empty(item);
		//alert(item+" can't be empty!");
		return false;
	}
	return true;
}

function option_select()
{
	var op60=false;
	var op61=false;
	var op125=false;

	if(document.lanoption_form.DHCPop60_enable[0].checked)
	{
		op60 = true;
	}
	else
	{
		op60 = false;
	}
	if(document.lanoption_form.DHCPop61_enable[0].checked)
	{
		op61 = true;
	}
	else
	{
		op61 = false;
	}
	if(document.lanoption_form.DHCPop125_enable[0].checked)
	{
		op125 = true;
	}
	else
	{
		op125 = false;
	}

	document.getElementById("id_DHCPop60_value").disabled = op60;
	document.getElementById("id_DHCPop60_vid").disabled = op60;
	document.getElementById("id_DHCPop60_pbit").disabled = op60;

	if(op61==false)
	{
		document.lanoption_form.DHCPop61_type[0].disabled = op61;
		document.lanoption_form.DHCPop61_type[1].disabled = op61;
		document.lanoption_form.DHCPop61_type[2].disabled = op61;
		document.getElementById("id_DHCPop61_vid").disabled = op61;
		document.getElementById("id_DHCPop61_pbit").disabled = op61;
		option61_type_change();
	}
	else{
		document.lanoption_form.DHCPop61_type[0].disabled = op61;
		document.lanoption_form.DHCPop61_type[1].disabled = op61;
		document.lanoption_form.DHCPop61_type[2].disabled = op61;
		document.getElementById("id_DHCPop61_ClientID").disabled = op61;
		document.getElementById("id_DHCPop61_iaid").disabled = op61;
		document.getElementById("id_DHCPop61_Enterprise").disabled = op61;
		document.getElementById("id_DHCPop61_Identifier").disabled = op61;
		document.getElementById("id_DHCPop61_DUID").disabled = op61;
		document.getElementById("id_DHCPop61_vid").disabled = op61;
		document.getElementById("id_DHCPop61_pbit").disabled = op61;
	}

	document.getElementById("id_DHCPop125_EnterpriseNum").disabled = op125;
	document.getElementById("id_DHCPop125_ManufacturerOui").disabled = op125;
	document.getElementById("id_DHCPop125_ProductClass").disabled = op125;
	document.getElementById("id_DHCPop125_ModelName").disabled = op125;
	document.getElementById("id_DHCPop125_SerialNum").disabled = op125;
	document.getElementById("id_DHCPop125_vid").disabled = op125;
	document.getElementById("id_DHCPop125_pbit").disabled = op125;
}

function check_DHCPOption()
{

	if(document.lanoption_form.DHCPop60_enable[1].checked)
	{
		if( (document.getElementById("id_DHCPop60_value").value == ""))
		{
			warn_not_empty("Option 60 Vender Class ID");
			return false;
		}
		for(i=0;i<document.getElementById("id_DHCPop60_value").value.length;i++)
		{
			c = document.getElementById("id_DHCPop60_value").value.charCodeAt(i);
			if (c=='34')
			{
				item = "Vender Class ID";
				warn_int(item);
				// alert(" "+item+" should be an integer.");
				return false;
			}
		}

		if( (document.getElementById("id_DHCPop60_vid").value == "") ||
		    (isBlank(document.getElementById("id_DHCPop60_vid").value)))
		{
			warn_not_empty("Option 60 Vid");
			return false;
		}

		if(!check_integer(document.getElementById("id_DHCPop60_vid").value))
		{
			item = "Option 60 Vid";
			msg = "Option 60 ";
			min = "0";
			max = "4094";
			warn_int_between(item,min,max);
			return false;
		}

		if (!check_integer_range(document.getElementById("id_DHCPop60_vid").value,0,4094))
		{
			item = "Option 60 Vid";
			msg = "Option 60 ";
			min = "0";
			max = "4094";
			warn_int_between(item,min,max);
			return false;
		}

		if( (document.getElementById("id_DHCPop60_pbit").value == "") ||
		    (isBlank(document.getElementById("id_DHCPop60_vid").value)) )
		{
			warn_not_empty("Option 60 Pbit");
			return false;
		}

		if(!check_integer(document.getElementById("id_DHCPop60_pbit").value))
		{
			item = "Option 60 PBit";
			msg = "Option 60 ";
			min = "0";
			max = "7";
			warn_int_between(item,min,max);
			return false;
		}

		if (!check_integer_range(document.getElementById("id_DHCPop60_pbit").value,0,7))
		{
			item = "Option 60 PBit";
			msg = "Option 60 ";
			min = "0";
			max = "7";
			warn_int_between(item,min,max);
			return false;
		}
	}
	if(document.lanoption_form.DHCPop61_enable[1].checked)
	{
		if (document.lanoption_form.DHCPop61_type[0].checked==true)
		{
			if( (document.getElementById("id_DHCPop61_ClientID").value == ""))
			{
				warn_not_empty("Option 61 Client ID");
				return false;
			}
			document.getElementById("id_DHCPop61_ClientID").value = document.getElementById("id_DHCPop61_ClientID").value.toLowerCase();
			if(!check_mac(document.getElementById("id_DHCPop61_ClientID").value))
			{
				item = "Client ID";
				msg = "";
				//warn_int(item)
				alert(msg+" "+item+" should be a MAC address.");
				return false;
			}
		}
		else if (document.lanoption_form.DHCPop61_type[1].checked==true)
		{
			//if(document.getElementById("id_DHCPop61_Enterprise").value=="")
			//{
			//	warn_not_empty("Option 61 Enterprise Number");
			//	return false;
			//}
			if (!check_integer_range(document.getElementById("id_DHCPop61_Enterprise").value,0,4294967295))
			{
				item = "[Enterprise Number]";
				msg = "DHCP";
				min = "0";
				max = "4294967295"; //2^32
				warn_int_between(item,min,max);
				//alert(msg+" "+item+" should be an integer between "+min+" and "+max);
				return false;
			}
			if(document.getElementById("id_DHCPop61_Identifier").value=="")
			{
				warn_not_empty("Option 61 Identifier");
				return false;
			}
			if(document.getElementById("id_DHCPop61_iaid").value=="")
			{
				warn_not_empty("Option 61 IAID");
				return false;
			}
		}
		else if (document.lanoption_form.DHCPop61_type[2].checked==true)
		{
			if(document.getElementById("id_DHCPop61_DUID").value=="")
			{
				warn_not_empty("Option 61 DUID");
				return false;
			}
			if(document.getElementById("id_DHCPop61_iaid").value=="")
			{
				warn_not_empty("Option 61 IAID");
				return false;
			}
		}
		if( (document.getElementById("id_DHCPop61_vid").value == "") ||
		    (isBlank(document.getElementById("id_DHCPop61_vid").value)))
		{
			warn_not_empty("Option 61 Vid");
			return false;
		}

		if(!check_integer(document.getElementById("id_DHCPop61_vid").value))
		{
			item = "Option 61 Vid";
			msg = "Option 61 ";
			min = "0";
			max = "4094";
			warn_int_between(item,min,max);
			return false;
		}

		if (!check_integer_range(document.getElementById("id_DHCPop61_vid").value,0,4094))
		{
			item = "Option 61 Vid";
			msg = "Option 61 ";
			min = "0";
			max = "4094";
			warn_int_between(item,min,max);
			return false;
		}

		if( (document.getElementById("id_DHCPop61_pbit").value == "") ||
		    (isBlank(document.getElementById("id_DHCPop61_vid").value)) )
		{
			warn_not_empty("Option 61 Pbit");
			return false;
		}

		if(!check_integer(document.getElementById("id_DHCPop61_pbit").value))
		{
			item = "Option 61 PBit";
			msg = "Option 61 ";
			min = "0";
			max = "7";
			warn_int_between(item,min,max);
			return false;
		}

		if (!check_integer_range(document.getElementById("id_DHCPop61_pbit").value,0,7))
		{
			item = "Option 61 PBit";
			msg = "Option 61 ";
			min = "0";
			max = "7";
			warn_int_between(item,min,max);
			return false;
		}
	}
	if(document.lanoption_form.DHCPop125_enable[1].checked)
	{
		if(document.getElementById("id_DHCPop125_EnterpriseNum").value=="")
		{
			warn_not_empty("Option 125 Enterprise Number");
			return false;
		}

		if(!check_integer(document.getElementById("id_DHCPop125_EnterpriseNum").value))
		{
			item = "Enterprise Number";
			warn_int(item);
			return false;
		}
		if(document.getElementById("id_DHCPop125_ManufacturerOui").value=="")
		{
			warn_not_empty("Option 125 Manufacturer Oui");
			return false;
		}
		if(document.getElementById("id_DHCPop125_ProductClass").value=="")
		{
			warn_not_empty("Option 125 Product Class");
			return false;
		}
		if(document.getElementById("id_DHCPop125_ModelName").value=="")
		{
			warn_not_empty("Option 125 Model Name");
			return false;
		}
		if(document.getElementById("id_DHCPop125_SerialNum").value=="")
		{
			warn_not_empty("Option 125 Serial Number");
			return false;
		}

		if( (document.getElementById("id_DHCPop125_vid").value == "") ||
		    (isBlank(document.getElementById("id_DHCPop125_vid").value)))
		{
			warn_not_empty("Option 125 Vid");
			return false;
		}

		if(!check_integer(document.getElementById("id_DHCPop125_vid").value))
		{
			item = "Option 125 Vid";
			msg = "Option 125 ";
			min = "0";
			max = "4094";
			warn_int_between(item,min,max);
			return false;
		}

		if (!check_integer_range(document.getElementById("id_DHCPop125_vid").value,0,4094))
		{
			item = "Option 125 Vid";
			msg = "Option 125 ";
			min = "0";
			max = "4094";
			warn_int_between(item,min,max);
			return false;
		}

		if( (document.getElementById("id_DHCPop125_pbit").value == "") ||
		    (isBlank(document.getElementById("id_DHCPop125_vid").value)) )
		{
			warn_not_empty("Option 125 Pbit");
			return false;
		}

		if(!check_integer(document.getElementById("id_DHCPop125_pbit").value))
		{
			item = "Option 125 PBit";
			msg = "Option 125 ";
			min = "0";
			max = "7";
			warn_int_between(item,min,max);
			return false;
		}

		if (!check_integer_range(document.getElementById("id_DHCPop125_pbit").value,0,7))
		{
			item = "Option 125 PBit";
			msg = "Option 125 ";
			min = "0";
			max = "7";
			warn_int_between(item,min,max);
			return false;
		}
	}
	if ( !check_ip(document.getElementById("id_PoolIPEnd_t").value) )
	{
		item = "Pool Ending IP";
		alert(item+" is not a valid IP address.");
		return false;
	}
	if ( !check_ip(document.getElementById("id_PoolIPStart_t").value) )
	{
		item = "Pool Starting IP";
		alert(item+" is not a valid IP address.");
		return false;
	}
	return true;
}

function saveChanges()
{
	var msg;
	var no;
	var i;
	var j;

	if(!check_DHCPOption())
		return false;

	fvt_form_submit('lanoption_form');
	document.getElementById('id_wait_progress').style.display="";
	check_process();
	document.lanoption_form.submit();
	localStorage.setItem("redirectPage", "1");
	return true;
}

function Passthrough_Enable()
{
	if(document.getElementById("id_DHCPPassthrough").value=="0")
	{
		document.lanoption_form.DHCPAction.disabled=true;
		document.lanoption_form.id_PoolIPStart_t.disabled=true;
		document.lanoption_form.id_PoolIPEnd_t.disabled=true;
	}else{
		document.lanoption_form.DHCPAction.disabled=false;
	}
}

function option61_type_change()
{
	if(document.lanoption_form.DHCPop61_type[0].checked)
	{
		document.lanoption_form.DHCPop61_ClientID.disabled=false;
		document.lanoption_form.DHCPop61_iaid.disabled=true;
		document.lanoption_form.DHCPop61_Enterprise.disabled=true;
		document.lanoption_form.DHCPop61_Identifier.disabled=true;
		document.lanoption_form.DHCPop61_DUID.disabled=true;
	}else if(document.lanoption_form.DHCPop61_type[1].checked){
		document.lanoption_form.DHCPop61_ClientID.disabled=true;
		document.lanoption_form.DHCPop61_iaid.disabled=false;
		document.lanoption_form.DHCPop61_Enterprise.disabled=false;
		document.lanoption_form.DHCPop61_Identifier.disabled=false;
		document.lanoption_form.DHCPop61_DUID.value="";
		document.lanoption_form.DHCPop61_DUID.disabled=true;
	}else{
		document.lanoption_form.DHCPop61_ClientID.disabled=true;
		document.lanoption_form.DHCPop61_iaid.disabled=false;
		document.lanoption_form.DHCPop61_Enterprise.value="";
		document.lanoption_form.DHCPop61_Enterprise.disabled=true;
		document.lanoption_form.DHCPop61_Identifier.disabled=true;
		document.lanoption_form.DHCPop61_DUID.disabled=false;
	}
}

function fvt_form_init(form_name)
{
//alert ("OPTN_Rule = " + OPTN_Rule);
	document.getElementById('id_showoption').style.display="block";
	if (form_name=='lanoption_form' || form_name=='*') {

		DHCPSEnable=fvt_meta_config('dhcp0_enable');
		var dhcp_pool_capability = fvt_meta_config('dhcp_pool'+OPTN_Rule+'_capability');
		// capability=2: Match Remote Server, 3: Match Local Server
		fvt_form_obj_set("lanoption_form", "DHCPAction", dhcp_pool_capability );

		if(dhcp_pool_capability=="1"){
			document.lanoption_form.DHCPPassthrough.value="0";
			document.lanoption_form.DHCPAction.disabled=true;
		}else{
			document.lanoption_form.DHCPPassthrough.value="1";
			document.lanoption_form.DHCPAction.disabled=false;
			if(dhcp_pool_capability=="2") //Match Remote Server
				{
				document.lanoption_form.id_PoolIPStart_t.disabled=true;
				document.lanoption_form.id_PoolIPEnd_t.disabled=true;
				}
			if(dhcp_pool_capability=="3") //Match Local Server
				{
				document.lanoption_form.id_PoolIPStart_t.disabled=false;
				document.lanoption_form.id_PoolIPEnd_t.disabled=false;
				}
		}

		fvt_form_obj_set("lanoption_form", "DHCPop60_enable", fvt_meta_config('dhcp_pool'+OPTN_Rule+'_option60_enable'));
		fvt_form_obj_set("lanoption_form", "DHCPop61_enable", fvt_meta_config('dhcp_pool'+OPTN_Rule+'_option61_enable'));
		fvt_form_obj_set("lanoption_form", "DHCPop125_enable", fvt_meta_config('dhcp_pool'+OPTN_Rule+'_option125_enable'));
		fvt_form_obj_set("lanoption_form", "DHCPop60_value", fvt_meta_config('dhcp_relay_option_value'+meta_opt60));
		fvt_form_obj_set("lanoption_form", "DHCPop60_vid", fvt_meta_config('dhcp_relay_vid'+meta_opt60));
		fvt_form_obj_set("lanoption_form", "DHCPop60_pbit", fvt_meta_config('dhcp_relay_cos'+meta_opt60));

		//if(fvt_meta_config('dhcp_relay_pool_name'+meta_opt60)!="")
		//	fvt_form_obj_set("lanoption_form", "DHCPop60_pool", fvt_meta_config('dhcp_relay_pool_name'+meta_opt60));
		//else
			fvt_form_obj_set("lanoption_form", "DHCPop60_pool", 'pool'+OPTN_Rule);

		if(fvt_meta_config('dhcp_relay_sub_option_num'+meta_opt61)=="0")
		{
			document.lanoption_form.DHCPop61_type[0].checked=true;
		}else if(fvt_meta_config('dhcp_relay_sub_option_num'+meta_opt61)=="2")
		{
			document.lanoption_form.DHCPop61_type[1].checked=true;
		}else if(fvt_meta_config('dhcp_relay_sub_option_num'+meta_opt61)=="255")
		{
			document.lanoption_form.DHCPop61_type[2].checked=true;
		}else
		{
			document.lanoption_form.DHCPop61_type[0].checked=true;
		}
		if (fvt_meta_config('dhcp_relay_option_value'+meta_opt61) == "")
			{
			fvt_form_obj_set("lanoption_form", "DHCPop61_ClientID", "");
			}
		else
			{
			var client_ID = fvt_meta_config('dhcp_relay_option_value'+meta_opt61).split(":");
			fvt_form_obj_set("lanoption_form", "DHCPop61_ClientID", client_ID[1]+":"+client_ID[2]+":"+client_ID[3]+":"+client_ID[4]+":"+client_ID[5]+":"+client_ID[6]);
			}

		fvt_form_obj_set("lanoption_form", "DHCPop61_iaid", fvt_meta_config('dhcp_relay_sub_option_value1_'+meta_opt61));
		fvt_form_obj_set("lanoption_form", "DHCPop61_duid", fvt_meta_config('dhcp_relay_sub_option_value2_'+meta_opt61));

		var do61_duid_mata_o=fvt_meta_config('dhcp_relay_sub_option_value2_'+meta_opt61);
		var do61_duid_mata=do61_duid_mata_o.replace(/\\x/g, '');
		var dhcpv4_opt61_duid_ent=HEX2DEC(do61_duid_mata);
		document.getElementById('id_DHCPop61_Enterprise').value = dhcpv4_opt61_duid_ent;

		fvt_form_obj_set("lanoption_form", "DHCPop61_DUID", fvt_meta_config('dhcp_relay_sub_option_value2_'+meta_opt61));

		fvt_form_obj_set("lanoption_form", "DHCPop61_Identifier", fvt_meta_config('dhcp_relay_sub_option_value3_'+meta_opt61));

		fvt_form_obj_set("lanoption_form", "DHCPop61_vid", fvt_meta_config('dhcp_relay_vid'+meta_opt61));
		fvt_form_obj_set("lanoption_form", "DHCPop61_pbit", fvt_meta_config('dhcp_relay_cos'+meta_opt61));
		//if(fvt_meta_config('dhcp_relay_pool_name'+meta_opt61)!="")
		//	fvt_form_obj_set("lanoption_form", "DHCPop61_pool", fvt_meta_config('dhcp_relay_pool_name'+meta_opt61));
		//else
			fvt_form_obj_set("lanoption_form", "DHCPop61_pool", 'pool'+OPTN_Rule);

		fvt_form_obj_set("lanoption_form", "DHCPop125_EnterpriseNum", fvt_meta_config('dhcp_relay_enterprise_num'+meta_opt125));
		fvt_form_obj_set("lanoption_form", "DHCPop125_ManufacturerOui", fvt_meta_config('dhcp_relay_sub_option_value1_'+meta_opt125));
		fvt_form_obj_set("lanoption_form", "DHCPop125_ProductClass", fvt_meta_config('dhcp_relay_sub_option_value2_'+meta_opt125));
		fvt_form_obj_set("lanoption_form", "DHCPop125_ModelName", fvt_meta_config('dhcp_relay_sub_option_value3_'+meta_opt125));
		fvt_form_obj_set("lanoption_form", "DHCPop125_SerialNum", fvt_meta_config('dhcp_relay_sub_option_value4_'+meta_opt125));
		fvt_form_obj_set("lanoption_form", "DHCPop125_vid", fvt_meta_config('dhcp_relay_vid'+meta_opt125));
		fvt_form_obj_set("lanoption_form", "DHCPop125_pbit", fvt_meta_config('dhcp_relay_cos'+meta_opt125));
		//if(fvt_meta_config('dhcp_relay_pool_name'+meta_opt125)!="")
		//	fvt_form_obj_set("lanoption_form", "DHCPop125_pool", fvt_meta_config('dhcp_relay_pool_name'+meta_opt125));
		//else
			fvt_form_obj_set("lanoption_form", "DHCPop125_pool", 'pool'+OPTN_Rule);

		option_select();
	}

	localStorage.setItem("redirectPage", "0");
}

function fvt_form_submit(form_name) 	{
	fvt_paramlist_clear();
//	var acl_lan16=fvt_form_obj_get("lanoption_form", "LanIPAddr")+"\/"+octet2cidr(fvt_form_obj_get("lanoption_form", "LanNetmask"));
	if (form_name=='lanoption_form' || form_name=='*') {

		fvt_paramlist_cat_str('dhcp0_pool'+OPTN_Rule+'_number_start', fvt_form_obj_get("lanoption_form", "PoolIPStart_t"));
		fvt_paramlist_cat_str('dhcp0_pool'+OPTN_Rule+'_number_end', fvt_form_obj_get("lanoption_form", "PoolIPEnd_t"));

		for (i=0; i<max_option; i++)
		{
			if ( i==OPTN_Rule )
				{
				if (document.getElementById('id_DHCPPassthrough').value== "1") eval("pool_pass"+i+"=0");
				else eval("pool_pass"+i+"=1");
				}
			else
				eval("pool_pass"+i+"=fvt_meta_config('dhcp_pool'+i+'_capability')");
		}

		if(DHCPSEnable=="1")
		{
			//if(document.getElementById("id_DHCPPassthrough").value!="1") //passthrough disable
			if( (pool_pass0=="1") && (pool_pass1=="1") && (pool_pass2=="1") && (pool_pass3=="1") ) //passthrough disable
			{
				fvt_paramlist_cat_str('remote0_gateway', "");
				fvt_paramlist_cat_str('remote1_gateway', "");
				fvt_paramlist_cat_str('remote2_gateway', "");
				fvt_paramlist_cat_str('remote3_gateway', "");
			}else //passthrough enable
			{
				fvt_paramlist_cat_str('remote0_gateway', "255.255.255.255");
				fvt_paramlist_cat_str('remote1_gateway', "255.255.255.255");
				fvt_paramlist_cat_str('remote2_gateway', "255.255.255.255");
				fvt_paramlist_cat_str('remote3_gateway', "255.255.255.255");
				fvt_paramlist_cat_str('dhcp_trigger_omcicli_enable', "1");
			}

			if(document.getElementById("id_DHCPPassthrough").value=="1") //passthrough enable
			{
				fvt_paramlist_cat_str('dhcp_pool'+OPTN_Rule+'_option125_enable', "1");
				fvt_paramlist_cat_str('dhcp_pool'+OPTN_Rule+'_capability', fvt_form_obj_get("lanoption_form", "DHCPAction"));
			}else //passthrough disable
			{
				fvt_paramlist_cat_str('dhcp_pool'+OPTN_Rule+'_capability', "1");
			}

			fvt_paramlist_cat_str('dhcp_pool'+OPTN_Rule+'_option60_enable', fvt_form_obj_get("lanoption_form", "DHCPop60_enable"));
			fvt_paramlist_cat_str('dhcp_pool'+OPTN_Rule+'_option61_enable', fvt_form_obj_get("lanoption_form", "DHCPop61_enable"));
			fvt_paramlist_cat_str('dhcp_pool'+OPTN_Rule+'_option125_enable', fvt_form_obj_get("lanoption_form", "DHCPop125_enable"));

			if(document.lanoption_form.DHCPop60_enable[1].checked)
			{
				fvt_paramlist_cat_str('dhcp_relay_option_id'+meta_opt60, "60");
				fvt_paramlist_cat_str('dhcp_relay_sub_option_num'+meta_opt60, "0");
				fvt_paramlist_cat_str('dhcp_relay_option_value'+meta_opt60, fvt_form_obj_get("lanoption_form", "DHCPop60_value"));
				fvt_paramlist_cat_str('dhcp_relay_pool_name'+meta_opt60, fvt_form_obj_get("lanoption_form", "DHCPop60_pool"));
				fvt_paramlist_cat_str('dhcp_relay_vid'+meta_opt60, fvt_form_obj_get("lanoption_form", "DHCPop60_vid"));
				fvt_paramlist_cat_str('dhcp_relay_cos'+meta_opt60, fvt_form_obj_get("lanoption_form", "DHCPop60_pbit"));

			}
			if(document.lanoption_form.DHCPop61_enable[1].checked)
			{
				fvt_paramlist_cat_str('dhcp_relay_option_id'+meta_opt61, "61");
				fvt_paramlist_cat_str('dhcp_relay_pool_name'+meta_opt61, fvt_form_obj_get("lanoption_form", "DHCPop61_pool"));
				fvt_paramlist_cat_str('dhcp_relay_vid'+meta_opt61, fvt_form_obj_get("lanoption_form", "DHCPop61_vid"));
				fvt_paramlist_cat_str('dhcp_relay_cos'+meta_opt61, fvt_form_obj_get("lanoption_form", "DHCPop61_pbit"));
				if(document.lanoption_form.DHCPop61_type[0].checked==true)
				{
					var client_ID = fvt_form_obj_get("lanoption_form", "DHCPop61_ClientID");
					fvt_paramlist_cat_str('dhcp_relay_option_value'+meta_opt61, "01:"+client_ID);
					fvt_paramlist_cat_str('dhcp_relay_sub_option_num'+meta_opt61, "0");
					fvt_paramlist_cat_str('dhcp_relay_sub_option_id1_'+meta_opt61, "");
					//fvt_paramlist_cat_str('dhcp_relay_sub_option_value1_'+meta_opt61, "");
					fvt_paramlist_cat_str('dhcp_relay_sub_option_id2_'+meta_opt61, "");
					//fvt_paramlist_cat_str('dhcp_relay_sub_option_value2_'+meta_opt61, "");
				}else if(document.lanoption_form.DHCPop61_type[1].checked==true)
				{
					//fvt_paramlist_cat_str('dhcp_relay_option_value'+meta_opt61, "");
					fvt_paramlist_cat_str('dhcp_relay_sub_option_num'+meta_opt61, "2");
					fvt_paramlist_cat_str('dhcp_relay_sub_option_id1_'+meta_opt61, "1");
					fvt_paramlist_cat_str('dhcp_relay_sub_option_value1_'+meta_opt61, fvt_form_obj_get("lanoption_form", "DHCPop61_iaid"));
					fvt_paramlist_cat_str('dhcp_relay_sub_option_id2_'+meta_opt61, "2");

					var dhcpv4_opt61_enterprise=DEC2HEX_array(fvt_form_obj_get("lanoption_form", "DHCPop61_Enterprise"));
					fvt_paramlist_cat_str('dhcp_relay_sub_option_value2_'+meta_opt61, dhcpv4_opt61_enterprise);
					fvt_paramlist_cat_str('dhcp_relay_sub_option_value3_'+meta_opt61, fvt_form_obj_get("lanoption_form", "DHCPop61_Identifier"));
				}else if(document.lanoption_form.DHCPop61_type[2].checked==true)
				{
					//fvt_paramlist_cat_str('dhcp_relay_option_value1', "");
					fvt_paramlist_cat_str('dhcp_relay_sub_option_num'+meta_opt61, "255");
					fvt_paramlist_cat_str('dhcp_relay_sub_option_id1_'+meta_opt61, "1");
					fvt_paramlist_cat_str('dhcp_relay_sub_option_value1_'+meta_opt61, fvt_form_obj_get("lanoption_form", "DHCPop61_iaid"));
					fvt_paramlist_cat_str('dhcp_relay_sub_option_id2_'+meta_opt61, "2");
					fvt_paramlist_cat_str('dhcp_relay_sub_option_value2_'+meta_opt61, fvt_form_obj_get("lanoption_form", "DHCPop61_DUID"));
					//fvt_paramlist_cat_str('dhcp_relay_sub_option_value3_1', fvt_form_obj_get("lanoption_form", "DHCPop61_Identifier"));
				}
			}
			if(document.lanoption_form.DHCPop125_enable[1].checked)
			{
				fvt_paramlist_cat_str('dhcp_relay_option_id'+meta_opt125, "125");
				fvt_paramlist_cat_str('dhcp_relay_enterprise_num'+meta_opt125, fvt_form_obj_get("lanoption_form", "DHCPop125_EnterpriseNum"));
				fvt_paramlist_cat_str('dhcp_relay_sub_option_num'+meta_opt125, "4");
				fvt_paramlist_cat_str('dhcp_relay_sub_option_id1_'+meta_opt125, "1");
				fvt_paramlist_cat_str('dhcp_relay_sub_option_value1_'+meta_opt125, fvt_form_obj_get("lanoption_form", "DHCPop125_ManufacturerOui"));
				fvt_paramlist_cat_str('dhcp_relay_sub_option_id2_'+meta_opt125, "2");
				fvt_paramlist_cat_str('dhcp_relay_sub_option_value2_'+meta_opt125, fvt_form_obj_get("lanoption_form", "DHCPop125_ProductClass"));
				fvt_paramlist_cat_str('dhcp_relay_sub_option_id3_'+meta_opt125, "3");
				fvt_paramlist_cat_str('dhcp_relay_sub_option_value3_'+meta_opt125, fvt_form_obj_get("lanoption_form", "DHCPop125_ModelName"));
				fvt_paramlist_cat_str('dhcp_relay_sub_option_id4_'+meta_opt125, "4");
				fvt_paramlist_cat_str('dhcp_relay_sub_option_value4_'+meta_opt125, fvt_form_obj_get("lanoption_form", "DHCPop125_SerialNum"));
				fvt_paramlist_cat_str('dhcp_relay_pool_name'+meta_opt125, fvt_form_obj_get("lanoption_form", "DHCPop125_pool"));
				fvt_paramlist_cat_str('dhcp_relay_vid'+meta_opt125, fvt_form_obj_get("lanoption_form", "DHCPop125_vid"));
				fvt_paramlist_cat_str('dhcp_relay_cos'+meta_opt125, fvt_form_obj_get("lanoption_form", "DHCPop125_pbit"));
			}
// option200
			if(document.getElementById("id_DHCPPassthrough").value=="1" ||  //passthrough enable
				document.lanoption_form.DHCPop60_enable[1].checked ||
				document.lanoption_form.DHCPop61_enable[1].checked ||
				document.lanoption_form.DHCPop125_enable[1].checked)
			{
				fvt_paramlist_cat_str('dhcp_pool'+OPTN_Rule+'_option200_enable', "1");
			}
			else
			{
				fvt_paramlist_cat_str('dhcp_pool'+OPTN_Rule+'_option200_enable', "0");
			}
		}
	}
	fvt_paramlist_presubmit(form_name);
}

function HEX2DEC(number) {
	// Return error if number is not hexadecimal or contains more than ten characters (10 digits)
	//if (!/^[0-9A-Fa-f]{1,10}$/.test(number)) return '#NUM!';
	if (!/^[0-9A-Fa-f]{1,10}$/.test(number)) return '';

	// Convert hexadecimal number to decimal
	var decimal = parseInt(number, 16);

	// Return decimal number
	return (decimal >= 549755813888) ? decimal - 1099511627776 : decimal;
}

function DEC2HEX(dec) {
	var buf = [],
	//map = '0123456789ABCDEF';
	map = '0123456789abcdef';
	while (parseInt(dec / 16, 10) !== 0) {
		buf.unshift(map[dec % 16]);
		dec = parseInt(dec / 16, 10);
	}
	buf.unshift(map[dec % 16]);
	return buf.join('');
};

function DEC2HEX_array(dec) {
	var result = DEC2HEX(dec);
	var result8 = result;
	var xout="";
	for (i = result.length ; i < 8; i++)
	{
		result8 = "0" + result8;
	}
	var hex_array = result8.match(/.{1,2}/g)
	for (i = 0 ; i <= 3; i++){xout = xout + "\\x" + hex_array[i];}
	return xout;
}

function Back()
{
	window.location.href="wwwctrl.cgi?action=lan_new";
}
//-->
function check_redirectPage()
{
	if (localStorage.getItem("redirectPage")=="1") Back();
}
function changematch()
{
	if(document.getElementById("id_DHCPAction").value=="2")
		{
		document.lanoption_form.id_PoolIPStart_t.disabled=true;
		document.lanoption_form.id_PoolIPEnd_t.disabled=true;
		}
	else
		{
		document.lanoption_form.id_PoolIPStart_t.disabled=false;
		document.lanoption_form.id_PoolIPEnd_t.disabled=false;
		}
}
</script>
</head>

<body align="left" onload="check_redirectPage();fvt_form_init('lanoption_form');">
<div id="container">
<table align="center" width="90%"><tbody>
<tr><td valign="top">
<form id="lanoption_form" name="lanoption_form" method="post" >
<fieldset>
	<div class="lv1_title">Advanced Setup&nbsp;&gt;&nbsp;
	<script language="javascript" type="text/javascript">
		document.write("LAN Option Pool [ " + OPTN_Rule + "	] Settings");
	</script>
	</div>
</fieldset>
<div class="div1_indent lv2_new">

<!--dhcp server-->
	<div><hr class="hr2"></div>
	<div>
		<table><tbody>
		<tr>
			<input ctrlflip='etc' name="nosave_DHCPPassthrough" id="mm_DHCPPassthrough" type="hidden"/>
			<td class="width_lanset1"><div ctrlflip="right" ctrlid="75">DHCP Passthrough</div></td>
			<td ctrlflip='etc'>
				<select ar='1' name="DHCPPassthrough" id="id_DHCPPassthrough" class="width_lansetEnable" onchange="Passthrough_Enable();" >
					<option value='0'>Disable</option>
					<option value='1'>Enable</option>
				</select>
			</td>
		</tr>
		<tr>
			<input ctrlflip='etc' name="nosave_DHCPAction" id="mm_DHCPAction" type="hidden"/>
			<td class="width_lanset1"><div ctrlflip="right" ctrlid="75">DHCP Server Mode</div></td>
			<td ctrlflip='etc'>
				<select ar='1' name="DHCPAction" id="id_DHCPAction" onchange="changematch()" width="100" >
					<option value='2'>Match Remote Server</option>
					<option value='3'>Match Local Server</option>
				</select>
			</td>
		</tr>
		</tbody></table>
	</div>
	<div id="id_showoption" style="display:none">
		<table><tbody>
		<tr>
			<td><div ctrlflip='right' ctrlid="79">Pool Starting IP Address</div></td>
			<input ctrlflip='etc' name="PoolIPStart" id="id_PoolIPStart" type="hidden">

			<script language="javascript" type="text/javascript">
				var IP_Address = fvt_meta_config('lan0_ip');
				var IP_Address_split = IP_Address.split(".");
				var Pool_Start_IP_Address = fvt_meta_config('dhcp0_pool'+OPTN_Rule+'_number_start');
				document.write("<td ctrlflip='right' ><div dir='ltr'>");
				document.write("<input disabled='disabled' id='id_PoolIPStart_t' class='width_ipAddr' size='16' maxlength='15' value='"+Pool_Start_IP_Address+"' type='text' name='PoolIPStart_t'>");
				document.write("</div></td>");
			</script>
		</tr>
		<tr>
			<td><div ctrlflip='right' ctrlid="79">Pool Ending IP Address</div></td>
			<input ctrlflip='etc' name="PoolIPEnd" id="id_PoolIPEnd" type="hidden">

			<script language="javascript" type="text/javascript">
				var Pool_End_IP_Address = fvt_meta_config('dhcp0_pool'+OPTN_Rule+'_number_end');
				document.write("<td ctrlflip='right' ><div dir='ltr'>");
				document.write("<input disabled='disabled' id='id_PoolIPEnd_t' class='width_ipAddr' size='16' maxlength='15' value='"+Pool_End_IP_Address+"' type='text' name='PoolIPEnd_t'>");
				document.write("</div></td>");
			</script>
		</tr>
		<tr>
			<td class="width_lanset1"><div ctrlflip="right" ctrlid="75">DHCP Option 60 :</div></td>
			<td><table><tr>
			<td><input type="radio" name="DHCPop60_enable" id="id_DHCPop60_enable" value="0" class="radio" onclick="option_select()" checked>Disable</td>
			<td>&nbsp;&nbsp;</td>
			<td><input type="radio" name="DHCPop60_enable" id="id_DHCPop60_enable" value="1" onclick="option_select()" class="radio">Enable</td>
			</tr></table></td>
		</tr>
		<input ctrlflip='etc' name="DHCPop60_pool" id="id_DHCPop60_pool" type="hidden">
		<tr>
			<td class="width_lanset1" ><div class="width_lanset3" ctrlflip="right" ctrlid="75">Vender Class ID</div></td>
			<td><input type="text" name="DHCPop60_value" id="id_DHCPop60_value"></td>
		</tr>
		<tr>
			<td class="width_lanset1"><div class="width_lanset3" ctrlflip="right" ctrlid="75">vid</div></td>
			<td><input type="text" name="DHCPop60_vid" id="id_DHCPop60_vid"></td>
		</tr>
		<tr>
			<td class="width_lanset1"><div class="width_lanset3" ctrlflip="right" ctrlid="75">pbit</div></td>
			<td><input type="text" name="DHCPop60_pbit" id="id_DHCPop60_pbit"></td>
		</tr>
		<tr>
			<td class="width_lanset1"><div ctrlflip="right" ctrlid="75">DHCP Option 61 :</div></td>
			<!--<td ctrlflip='etc'>
				<select ar='1' name="DHCPop61_enable" id="id_DHCPop61_enable" class="width_lansetEnable" onchange="option_select();" >
					<option value='0'>Disable</option>
					<option value='1'>Enable</option>
				</select>
			</td>-->
			<td><table><tr>
			<td><input type="radio" name="DHCPop61_enable" id="id_DHCPop61_enable" value="0" class="radio" onclick="option_select()" checked>Disable</td>
			<td>&nbsp;&nbsp;</td>
			<td><input type="radio" name="DHCPop61_enable" id="id_DHCPop61_enable" value="1" onclick="option_select()" class="radio">Enable</td>
			</tr></table></td>
		</tr>
		<input ctrlflip='etc' name="DHCPop61_pool" id="id_DHCPop61_pool" type="hidden">
		<tr>
			<td class="width_lanset1"><div class="width_lanset3" ctrlflip="etc" ctrlid="369">Type</div></td>
				<td><table><tr>
				<td><input type="radio" name="DHCPop61_type" id="id_DHCPop61_type" value="1" onclick="option61_type_change()" class="radio" checked>Type 1</td>
				<td>&nbsp;&nbsp;</td>
				<td><input type="radio" name="DHCPop61_type" id="id_DHCPop61_type" value="2" onclick="option61_type_change()" class="radio">Type 2</td>
				<td>&nbsp;&nbsp;</td>
				<td><input type="radio" name="DHCPop61_type" id="id_DHCPop61_type" value="255" onclick="option61_type_change()" class="radio">Type 255</td>
				</tr></table></td>
		</tr>
		<tr>
			<td class="width_lanset1" ><div class="width_lanset3" ctrlflip="right" ctrlid="75">Client ID</div></td>
			<td><input type="text" name="DHCPop61_ClientID" id="id_DHCPop61_ClientID"></td>
		</tr>
		<tr>
			<td class="width_lanset1" ><div class="width_lanset3" ctrlflip="right" ctrlid="75">IAID</div></td>
			<td><input type="text" name="DHCPop61_iaid" id="id_DHCPop61_iaid" maxlength="4"></td>
		</tr>
		<tr>
			<td class="width_lanset1"><div class="width_lanset3" ctrlflip="right" ctrlid="75">Enterprise Number</div></td>
			<td><input type="text" name="DHCPop61_Enterprise" id="id_DHCPop61_Enterprise"></td>
		</tr>
		<tr>
			<td class="width_lanset1"><div class="width_lanset3" ctrlflip="right" ctrlid="75">Identifier</div></td>
			<td><input type="text" name="DHCPop61_Identifier" id="id_DHCPop61_Identifier"></td>
		</tr>
		<tr>
			<td class="width_lanset1" ><div class="width_lanset3" ctrlflip="right" ctrlid="75">DUID</div></td>
			<td><input type="text" name="DHCPop61_DUID" id="id_DHCPop61_DUID"></td>
		</tr>

		<tr>
			<td class="width_lanset1"><div class="width_lanset3" ctrlflip="right" ctrlid="75">vid</div></td>
			<td><input type="text" name="DHCPop61_vid" id="id_DHCPop61_vid"></td>
		</tr>
		<tr>
			<td class="width_lanset1"><div class="width_lanset3" ctrlflip="right" ctrlid="75">pbit</div></td>
			<td><input type="text" name="DHCPop61_pbit" id="id_DHCPop61_pbit"></td>
		</tr>
		<tr>
			<td class="width_lanset1"><div ctrlflip="right" ctrlid="75">DHCP Option 125 :</div></td>
			<td><table><tr>
			<td><input type="radio" name="DHCPop125_enable" id="id_DHCPop125_enable" value="0" class="radio" onclick="option_select()" checked>Disable</td>
			<td>&nbsp;&nbsp;</td>
			<td><input type="radio" name="DHCPop125_enable" id="id_DHCPop125_enable" value="1" onclick="option_select()" class="radio">Enable</td>
			</tr></table></td>
		</tr>
		<input ctrlflip='etc' name="DHCPop125_pool" id="id_DHCPop125_pool" type="hidden">
		<tr>
			<td><div class="width_lanset3" ctrlflip="right" ctrlid="336">Enterprise Number</div></td>
			<td><input ctrlflip="etc" type="text" name="DHCPop125_EnterpriseNum" id="id_DHCPop125_EnterpriseNum" ></td>
		</tr>
		<tr>
			<td><div class="width_lanset3" ctrlflip="right" ctrlid="336">Manufacturer Oui</div></td>
			<td><input ctrlflip="etc" type="text" name="DHCPop125_ManufacturerOui" id="id_DHCPop125_ManufacturerOui" ></td>
		</tr>
		<tr>
			<td><div class="width_lanset3" ctrlflip="right" ctrlid="336">Product Class</div></td>
			<td><input ctrlflip="etc" type="text" name="DHCPop125_ProductClass" id="id_DHCPop125_ProductClass"></td>
		</tr>
		<tr>
			<td><div class="width_lanset3" ctrlflip="right" ctrlid="336">Model Name</div></td>
			<td><input ctrlflip="etc" type="text" name="DHCPop125_ModelName" id="id_DHCPop125_ModelName"></td>
		</tr>
		<tr>
			<td><div class="width_lanset3" ctrlflip="right" ctrlid="336">Serial Number</div></td>
			<td><input ctrlflip="etc" type="text" name="DHCPop125_SerialNum" id="id_DHCPop125_SerialNum"></td>
		</tr>
		<tr>
			<td class="width_lanset1"><div class="width_lanset3" ctrlflip="right" ctrlid="75">vid</div></td>
			<td><input type="text" name="DHCPop125_vid" id="id_DHCPop125_vid"></td>
		</tr>
		<tr>
			<td class="width_lanset1"><div class="width_lanset3" ctrlflip="right" ctrlid="75">pbit</div></td>
			<td><input type="text" name="DHCPop125_pbit" id="id_DHCPop125_pbit"></td>
		</tr>
		</tbody></table>
	</div>

	<div class="top_cwmp2">
	<table><tbody>
		<tr>
			<td class="button_center">
				<input ctrlflip="etc" type="button" onclick="saveChanges()" name="applybtn" value="Apply Changes" class="width_apply">
				<input ctrlflip="etc" type="button" onclick="Back()" name="applybtn" value="Back" class="width_apply">
			</td>
			<td class="button_center">
			</td>
		</tr>
		<tr id="id_wait_progress" style="display:none">
			<td width="800px" align="center">
				<img src="../images/progress1.gif">
			</td>
		</tr>

	</tbody></table>
	</div>
</div>
</form>
</td></tr>
</tbody></table>
</div>
</body>
</html>

<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<link rel="stylesheet" type="text/css" href="../css/common.css" media="all">
<script language="javascript" type="text/javascript" src="../js/menu_base.js"></script>
<script language="javascript" type="text/javascript" src="../js/menu.js"></script>
<script language="javascript" type="text/javascript" src="../js/common.js"></script>
<script language="javascript" type="text/javascript" src="../js/fvt.js"></script>
<style>
table tr{Line-height:19pt;}
td.width_portF3{width:210px;}
td.align_center{text-align:center;}
td.paddingleft{padding-left:5px;}
tr.lightgray{background-color:#EDEDED;}
</style>

<script language="javascript" type="text/javascript">
var maxrule = 16;
var NodeLength = 0;
var edit_rule = 99;
var wan_max = 8;

function faceinter()
{
	var ifname,iftype;
	for (k=0;k<wan_max;k++)
	{
		if(fvt_meta_config("wan"+k+"_if_name") != '')
		{
			iftype = fvt_meta_config("wan"+k+"_ip_assignment");
			ifname = fvt_meta_config("wan"+k+"_if_name");
			ifinter = fvt_meta_config("dev_wan"+k+"_interface");
			document.write("<option value='"+ifinter+"'>"+ifinter+"("+ifname+")</option>");
		}
	}
}

function SetPrf(type, index)
{
	var rule_index = index;
	var pf_en_key;
	var en=0;

	if(type=="0")
	{
		en=1;
		document.getElementById("id_prf_status").value="1"; //+":"+index;
	}
	else
	{
		en =0;
		document.getElementById("id_prf_status").value="0"; //+":"+index;
	}

	pf_en_key = 'nat0_classify_snat_'+rule_index+'_en';
	fvt_paramlist_cat_str(pf_en_key , en);

	fvt_paramlist_presubmit("prf_table_form");
	document.getElementById('id_apply_tr').style.display="none";
	document.getElementById('id_wait_progress').style.display="";
	document.getElementById("id_prf_table_form").submit();
}

function openList()
{
		newWindow = window.open('../cgi-bin/wwwctrl.cgi?action=protocol_num','Protocol',
				'modal=yes,width=870,height=500,left=100,screenX=100,top=200,screen=200,resizable=no');
}

function isFallRule()
{
	/*
	if (NodeLength>=maxrule)
		document.getElementById("add_applybtn").disabled=true;
	*/
	if(get_empty_index() <0)
		document.getElementById("add_applybtn").disabled=true;

}

function checkSpecSymbol(s)
{
	for(i=0;i<s.length;i++)
	{
	c=s.charAt(i);
	if(c==';')
		return false;
	}
	return true;
}

function prf_check()
{
	var item,min,max;
	var i=0;
	var No=0;
	if (document.getElementById("id_PRFAP").value.length==0 || !checkSpecSymbol(document.getElementById("id_PRFAP").value))
	{
		item = "Name";
		alert("The "  + item + " is invalid!");
		document.getElementById("id_PRFAP").focus();
		return;
	}

	if(document.getElementById("id_user_prot").value=="TCP" || document.getElementById("id_user_prot").value=="UDP" )
	{
		if (document.getElementById("id_PRFPORT2").checked)
		{
			if (document.getElementById("id_manual_port").value.length==0 &&
				!check_integer_range(document.getElementById("id_manual_port").value,1,65535))
			{
				min = 1;
				max = 65535;
				item = "Port";
				alert(item+" should be an integer between "+min+" and "+max);
				document.getElementById("id_manual_port").focus();
				return;
			}
			//document.getElementById("id_manual_port").value = parseInt(document.getElementById("id_manual_port").value);
		}
		else if (document.getElementById("id_PRFPORT3").checked)
		{
			if (document.getElementById("id_manual_sport").value.length==0 &&
				!check_integer_range(document.getElementById("id_manual_sport").value,1,65535))
			{
				min = 1;
				max = 65535;
				item = "Port";
				alert(item+" should be an integer between "+min+" and "+max);
				document.getElementById("id_manual_sport").focus();
				return;
			}
			if (document.getElementById("id_manual_eport").value.length==0 &&
				!check_integer_range(document.getElementById("id_manual_eport").value,1,65535))
			{
				min = 1;
				max = 65535;
				item = "Port";
				alert(item+" should be an integer between "+min+" and "+max);
				document.getElementById("id_manual_eport").focus();
				return;
			}
			if (parseInt(document.getElementById("id_manual_eport").value)
				 <= parseInt(document.getElementById("id_manual_sport").value))
			{
				item = "Port";
				alert("The "  + item + " is invalid!");
				document.getElementById("id_manual_eport").focus();
				return;
			}
		}
	}

	merge_ip("id_srcIP","id_srcIP_item1","id_srcIP_item2","id_srcIP_item3","id_srcIP_item4");
	merge_mac("id_srcMAC","id_srcMAC_item1","id_srcMAC_item2","id_srcMAC_item3","id_srcMAC_item4","id_srcMAC_item5","id_srcMAC_item6");

	if((document.getElementById("id_srcIP").value=="")&&(document.getElementById("id_srcMAC").value==""))
	{
		//alert("The Source IP or Source MAC should not be empty!");
		if (!confirm("Note: The Source IP and Source MAC are empty!\nAre you sure you want to add this rule?")) return false;
		//return false;
	}
	else
	{
		if (!check_ip_range(document.getElementById("id_srcIP").value, document.getElementById("id_srcNetmask").value))
		{
			item = "Source IP Address";
			alert("The "  + item + " is invalid!");
			return;
		}
		if (document.getElementById("id_srcIP").value!="")
			document.getElementById("id_srcIPflag").value="1";

		if (!check_mac(document.getElementById("id_srcMAC").value))
		{
			alert("Source MAC is invalid!!");
			return false;
		}

		if(!check_duplicate())
			return false;
	}
	fvt_form_submit('pwd_form');
	document.getElementById('id_apply_tr').style.display="none";
	document.getElementById('id_wait_progress').style.display="";
	document.getElementById("id_pwd_form").submit();
}

function check_duplicate()
{
	var val_n=document.getElementById("id_check_item").value;

	var j=0;
	for(j=0;j<maxrule;j++)
	{
		if(j==val_n)
			continue;
		else
		{
			var name_flag=0;
			var proto_flag=0;
			var port_flag=0;
			var port_select_flag=0;
			var srcip_flag=0;
			var wanif_flag=0;
			var mac_flag=0;
			pf_en_key = fvt_meta_config('nat0_classify_snat_'+j+'_en');
			pf_name_key = fvt_meta_config('nat0_classify_snat_'+j+'_name');
			pf_proto_key = fvt_meta_config('nat0_classify_snat_'+j+'_type');
			pf_port_key = fvt_meta_config('nat0_classify_snat_'+j+'_sport');
			pf_port_select_key = fvt_meta_config('nat0_classify_snat_'+j+'_port_select');
			pf_srcip_key = fvt_meta_config('nat0_classify_snat_'+j+'_srcip');
			pf_wanif_key = fvt_meta_config('nat0_classify_snat_'+j+'_to_wan');
			pf_mac_key = fvt_meta_config('nat0_classify_snat_'+j+'_mac');

			if(pf_name_key==document.getElementById("id_PRFAP").value)
			{
				alert("Rule name \""+ pf_name_key +"\" is duplicat");
				return false
			}
			var proto_val = document.getElementById("id_user_prot").value;
			if(proto_val=="NONE")
				proto_val="";
			if(pf_proto_key==proto_val)
			{
				proto_flag=1;
			}
			if(proto_val=="" || proto_val=="ICMP")
			{
				port_flag=1;
			}
			else
			{
				if (document.getElementById('id_PRFPORT2').checked == true)
				{
					if(pf_port_key==document.getElementById("id_manual_port").value)
						port_flag=1;
				}else
				{
					var port_range_val =  fvt_form_obj_get("pwd_form", "PORTSTART")+'-'+fvt_form_obj_get("pwd_form", "PORTEND");
					if(pf_port_key==port_range_val)
						port_flag=1;
				}
			}

			var ip_and_mask =  fvt_form_obj_get("pwd_form", "srcIP")+'/'+ fvt_form_obj_get("pwd_form", "srcNetmask");
			if(pf_srcip_key==ip_and_mask)
			{
				srcip_flag=1;
			}
			if(pf_mac_key==document.getElementById("id_srcMAC").value)
			{
				mac_flag=1;
			}
			if(proto_flag==1 && port_flag==1 && srcip_flag==1 && mac_flag==1)
			{
				alert("The same rule exist in rule named \""+pf_name_key+"\"");
				return false;
			}
		}
	}
	return true;
}

function deleteRule(val)
{
	var rule_index = val;

	var pf_en_key;
	var pf_name_key;
	var pf_proto_key;
	var pf_port_key;
	var pf_port_select_key;
	var pf_srcip_key;
	var pf_wanif_key;
	var port_range_val;
	var pf_mac_key;

	fvt_paramlist_clear();

	document.getElementById("id_delete_item").value=val;

	{
			pf_en_key = 'nat0_classify_snat_'+rule_index+'_en';
			pf_name_key = 'nat0_classify_snat_'+rule_index+'_name';
			pf_proto_key = 'nat0_classify_snat_'+rule_index+'_type';
			pf_port_key = 'nat0_classify_snat_'+rule_index+'_sport';
			pf_port_select_key = 'nat0_classify_snat_'+rule_index+'_port_select';
			pf_srcip_key = 'nat0_classify_snat_'+rule_index+'_srcip';
			pf_mac_key = 'nat0_classify_snat_'+rule_index+'_mac';
			pf_wanif_key = 'nat0_classify_snat_'+rule_index+'_to_wan';

			fvt_paramlist_cat_str(pf_en_key ,"0");
			fvt_paramlist_cat_str(pf_name_key ,"");
			fvt_paramlist_cat_str(pf_proto_key ,"");
			fvt_paramlist_cat_str(pf_port_key ,"");
			fvt_paramlist_cat_str(pf_port_select_key ,"1");
			fvt_paramlist_cat_str(pf_srcip_key ,"");
			fvt_paramlist_cat_str(pf_mac_key ,"");
			fvt_paramlist_cat_str(pf_wanif_key ,"");
	}

	//fvt_form_submit('prf_table_form');
	fvt_paramlist_presubmit('prf_table_form');
	document.getElementById('id_apply_tr').style.display="none";
	document.getElementById('id_wait_progress').style.display="";
	document.getElementById("id_prf_table_form").submit();
}

function editRule(val)
{
	edit_rule=val;

	document.getElementById("add_applybtn").disabled=false;
	document.getElementById("add_applybtn").value="Apply";
	document.getElementById("id_edit_item").value=val;
	document.getElementById("id_check_item").value=val;

	document.getElementById("id_PRFAP").value = document.getElementById("id_hidden_app" + val).value;


	document.getElementById("id_user_prot").value = document.getElementById("id_hidden_proto_known" + val).value;

	if(document.getElementById("id_user_prot").value=="TCP" || document.getElementById("id_user_prot").value=="UDP")
	{
		if (document.getElementById("id_hidden_radio1_"+val).value=="2")
		{
			document.getElementById("id_PRFPORT3").checked = true;
			document.getElementById("id_manual_sport").value = document.getElementById("id_hidden_sport"+val).value;
			document.getElementById("id_manual_eport").value = document.getElementById("id_hidden_eport"+val).value;
			disabledPort(false);
			checkPort();
		}
		else
		{
			document.getElementById("id_PRFPORT2").checked = true;
			document.getElementById("id_manual_port").value = document.getElementById("id_hidden_port_single"+val).value;
			disabledPort(false);
			checkPort();
		}
	}else
	{
		disabledPort(true);
	}
	/*if (document.getElementById("id_hidden_radio2_"+val).value=="1") //Auto lan ip
	{
		document.getElementById("id_auto_lanip").value =document.getElementById("id_hidden_lanip_auto"+val).value ;
	}*/

	var srcnetmask =document.getElementById("id_hidden_srcnetmask_" + val).value;

	document.getElementById("id_srcIP_item1").value = document.getElementById("id_hidden_srcip_item1_" + val).value;
	document.getElementById("id_srcIP_item2").value = document.getElementById("id_hidden_srcip_item2_" + val).value;
	document.getElementById("id_srcIP_item3").value = document.getElementById("id_hidden_srcip_item3_" + val).value;
	document.getElementById("id_srcIP_item4").value = document.getElementById("id_hidden_srcip_item4_" + val).value;

	//if (srcnetmask != 0 || srcnetmask != "")
	// document.getElementById("id_srcNetmask").options[32-srcnetmask].selected=true;
	var option_index = 0;
	if(srcnetmask == "255.255.255.255")
		option_index = 0;
	else if(srcnetmask == "255.255.255.254")
		option_index = 1;
	else if(srcnetmask == "255.255.255.252")
		option_index = 2;
	else if(srcnetmask == "255.255.255.248")
		option_index = 3;
	else if(srcnetmask == "255.255.255.240")
		option_index = 4;
	else if(srcnetmask == "255.255.255.224")
		option_index = 5;
	else if(srcnetmask == "255.255.255.192")
		option_index = 6;
	else if(srcnetmask == "255.255.255.128")
		option_index = 7;
	else if(srcnetmask == "255.255.255.0")
		option_index = 8;
	else if(srcnetmask == "255.255.254.0")
		option_index = 9;
	else if(srcnetmask == "255.255.252.0")
		option_index = 10;
	else if(srcnetmask == "255.255.248.0")
		option_index = 11;
	else if(srcnetmask == "255.255.240.0")
		option_index = 12;
	else if(srcnetmask == "255.255.224.0")
		option_index = 13;
	else if(srcnetmask == "255.255.192.0")
		option_index = 14;
	else if(srcnetmask == "255.255.128.0")
		option_index = 15;
	else if(srcnetmask == "255.255.0.0")
		option_index = 16;
	else if(srcnetmask == "255.254.0.0")
		option_index = 17;
	else if(srcnetmask == "255.252.0.0")
		option_index = 18;
	else if(srcnetmask == "255.248.0.0")
		option_index = 19;
	else if(srcnetmask == "255.240.0.0")
		option_index = 20;
	else if(srcnetmask == "255.224.0.0")
		option_index = 21;
	else if(srcnetmask == "255.192.0.0")
		option_index = 22;
	else if(srcnetmask == "255.128.0.0")
		option_index = 23;
	else if(srcnetmask == "255.0.0.0")
		option_index = 24;
	else if(srcnetmask == "254.0.0.0")
		option_index = 25;
	else if(srcnetmask == "252.0.0.0")
		option_index = 26;
	else if(srcnetmask == "248.0.0.0")
		option_index = 27;
	else if(srcnetmask == "240.0.0.0")
		option_index = 28;
	else if(srcnetmask == "224.0.0.0")
		option_index = 29;
	else if(srcnetmask == "192.0.0.0")
		option_index = 30;
	else if(srcnetmask == "128.0.0.0")
		option_index = 31;
	//else if(srcnetmask == "0.0.0.0")
	//	option_index = 32;
		document.getElementById("id_srcNetmask").options[option_index].selected=true;

	document.getElementById("id_srcMAC_item1").value = document.getElementById("id_hidden_srcmac_item1_" + val).value;
	document.getElementById("id_srcMAC_item2").value = document.getElementById("id_hidden_srcmac_item2_" + val).value;
	document.getElementById("id_srcMAC_item3").value = document.getElementById("id_hidden_srcmac_item3_" + val).value;
	document.getElementById("id_srcMAC_item4").value = document.getElementById("id_hidden_srcmac_item4_" + val).value;
	document.getElementById("id_srcMAC_item5").value = document.getElementById("id_hidden_srcmac_item5_" + val).value;
	document.getElementById("id_srcMAC_item6").value = document.getElementById("id_hidden_srcmac_item6_" + val).value;

	document.getElementById("id_wanif").value = document.getElementById("id_hidden_wanif" + val).value;

}

function isBridgeMode()
{
		var wan_type="";
		if (wan_type=="bridge")
				document.getElementById("add_applybtn").disabled=true;
}

function disabledPort(val)
{
	document.getElementById("id_PRFPORT2").disabled=val;
	document.getElementById("id_PRFPORT3").disabled=val;
	document.getElementById("id_manual_port").disabled=val;
	document.getElementById("id_manual_sport").disabled=val;
	document.getElementById("id_manual_eport").disabled=val;
}

function checkPort()
{
	document.getElementById("id_manual_port").disabled=true;
	document.getElementById("id_manual_sport").disabled=true;
	document.getElementById("id_manual_eport").disabled=true;
	if (document.getElementById("id_PRFPORT2").checked)
	{
		document.getElementById("id_manual_port").disabled=false;
	}
	else
	{
		document.getElementById("id_manual_sport").disabled=false;
		document.getElementById("id_manual_eport").disabled=false;
	}
}

function checkProto()
{
	if (document.getElementById("id_user_prot").value=="TCP" || document.getElementById("id_user_prot").value=="UDP" )
	{
		disabledPort(false);
		checkPort();
	}
	else
		disabledPort(true);
}

function get_empty_index()
{
	var i;
	var pf_name_key;
	var rule_index;

	if( document.getElementById("id_edit_item").value != "" && document.getElementById("id_edit_item").value != 0)
		return document.getElementById("id_edit_item").value;

	for(i=0; i< maxrule; i++)
	{
		rule_index = i;
		pf_name_key = 'nat0_classify_snat_'+rule_index+'_name';
		if( fvt_meta_config(pf_name_key) == "")
		{
			return rule_index;
		}
	}

	return -1;
}

function get_wan_name_by_interface(interface)
{
	var wan_name_key="";
	var wan_interface_key = "";
	var i = 0;
	var wanIndex = -1;

	if(interface==null || interface==undefined || interface=="")
		return"--";

	for(i=0; i<8; i++)
	{
		wan_interface_key = "dev_wan"+i+"_interface";
		if( fvt_meta_config(wan_interface_key) == interface)
		{
			wanIndex = i;
			break;
		}
	}

	if( wanIndex >= 0)
	{
		return fvt_meta_config("wan"+wanIndex+"_if_name");
	}
	return "--";
}

function list_port_forward_rules()
{
	var i;
	var count=0;
	var type;
	var rule_index;

	var pf_en_key;
	var pf_name_key;
	var pf_proto_key;
	var pf_port_key;
	var pf_port_select_key;
	var pf_srcip_key;
	var port_range_val;
	var ip_and_mask;
	var pf_wanif_key

	fvt_form_init('prf_table_form');

	for(i=0;i<maxrule;i++)
	{
		rule_index = i;
		pf_en_key = 'nat0_classify_snat_'+rule_index+'_en';
		pf_name_key = 'nat0_classify_snat_'+rule_index+'_name';
		pf_proto_key = 'nat0_classify_snat_'+rule_index+'_type';
		pf_port_key = 'nat0_classify_snat_'+rule_index+'_sport';
		pf_port_select_key = 'nat0_classify_snat_'+rule_index+'_port_select';
		pf_srcip_key = 'nat0_classify_snat_'+rule_index+'_srcip';
		pf_wanif_key = 'nat0_classify_snat_'+rule_index+'_to_wan';
		pf_mac_key = 'nat0_classify_snat_'+rule_index+'_mac';

		var prfStatus = fvt_meta_config(pf_en_key);
		//var j=i;
		var option0,option1,option2;

		var Name = fvt_meta_config(pf_name_key);

		if(Name=="")
			continue;

		if(prfStatus == "1")
			{type = "Disable";}
		else
			{type = "Enable";}

		if(count%2 == 0)
			document.write("<tr class='color_rown'>");
		else
			document.write("<tr class='color_rowh'>");

		count++;

		//var radio0 = fvt_meta_config(pf_proto_key);
		document.write("<td ctrlflip='right'>"+Name+"<input type='hidden' id='id_hidden_app"+rule_index+"' value='"+Name+"'></td>");

		if(fvt_meta_config(pf_proto_key)!="")
		{
			var proto = fvt_meta_config(pf_proto_key);
			document.write("<td ctrlflip='right'>"+proto+"<input type='hidden' id='id_hidden_proto_known"+rule_index+"' value='"+proto+"'></td>");
		}else
		{
			var proto = "NONE";
			document.write("<td ctrlflip='right'>"+proto+"<input type='hidden' id='id_hidden_proto_known"+rule_index+"' value='"+proto+"'></td>");
		}

		var radio1 = fvt_meta_config(pf_port_select_key);

		//if(radio1 == "1") //single port
		var port = fvt_meta_config(pf_port_key);
		if( port.indexOf("-")<0)
		{
			radio1 = 1;
			var port = fvt_meta_config(pf_port_key);
			document.write("<td ctrlflip='right'>"+port+"<input type='hidden' id='id_hidden_port_single"+rule_index+"' value='"+port+"'></td>");
		}
		else //port range
		{
			radio1 = 2;
			var port = fvt_meta_config(pf_port_key).split("-");
			var sport =port[0];
			var eport = port[1];
			document.write("<td><table>");
			document.write("<tr><td>"+sport+"<input type='hidden' id='id_hidden_sport"+rule_index+"' value='"+sport+"'></td></tr>");
			document.write("<tr><td>"+eport+"<input type='hidden' id='id_hidden_eport"+rule_index+"' value='"+eport+"'></td></tr>");
			document.write("</table></td>");
		}

		var ip_and_mask = fvt_meta_config(pf_srcip_key).split("/");
		var srcIP = ip_and_mask[0];
		var srcMask = ip_and_mask[1];
		if(srcIP != "")
		{
			var src_IP = srcIP.split(".");
			document.write("<td><table>");
			document.write("<tr><td ctrlflip='right'>"+srcIP+"</td></tr>");
			document.write("<tr><td ctrlflip='right'>"+srcMask+"</td></tr>");
			document.write("<input type='hidden' id='id_hidden_srcip_item1_"+rule_index+"' value='"+src_IP[0]+"'>");
			document.write("<input type='hidden' id='id_hidden_srcip_item2_"+rule_index+"' value='"+src_IP[1]+"'>");
			document.write("<input type='hidden' id='id_hidden_srcip_item3_"+rule_index+"' value='"+src_IP[2]+"'>");
			document.write("<input type='hidden' id='id_hidden_srcip_item4_"+rule_index+"' value='"+src_IP[3]+"'>");
			document.write("</table></td>");
		}
		else
		{
			document.write("<td ctrlflip='right'>All");
			document.write("<input type='hidden' id='id_hidden_srcip_item1_"+rule_index+"' value=''>");
			document.write("<input type='hidden' id='id_hidden_srcip_item2_"+rule_index+"' value=''>");
			document.write("<input type='hidden' id='id_hidden_srcip_item3_"+rule_index+"' value=''>");
			document.write("<input type='hidden' id='id_hidden_srcip_item4_"+rule_index+"' value=''>");
			document.write("</td>");
		}
		document.write("<input type='hidden' id='id_hidden_srcip_"+rule_index+"' value='"+srcIP+"'>");
		document.write("<input type='hidden' id='id_hidden_srcnetmask_"+rule_index+"' value='"+srcMask+"'>");

		var srcMac = fvt_meta_config(pf_mac_key);
		if(srcMac != "")
		{
			var src_Mac = srcMac.split(":");
			document.write("<td><table><tr><td ctrlflip='right'>"+srcMac+"</td></tr>");
			document.write("<input type='hidden' id='id_hidden_srcmac_item1_"+rule_index+"' value='"+src_Mac[0]+"'>");
			document.write("<input type='hidden' id='id_hidden_srcmac_item2_"+rule_index+"' value='"+src_Mac[1]+"'>");
			document.write("<input type='hidden' id='id_hidden_srcmac_item3_"+rule_index+"' value='"+src_Mac[2]+"'>");
			document.write("<input type='hidden' id='id_hidden_srcmac_item4_"+rule_index+"' value='"+src_Mac[3]+"'>");
			document.write("<input type='hidden' id='id_hidden_srcmac_item5_"+rule_index+"' value='"+src_Mac[4]+"'>");
			document.write("<input type='hidden' id='id_hidden_srcmac_item6_"+rule_index+"' value='"+src_Mac[5]+"'>");
			document.write("</table></td>");
		}
		else
		{
			document.write("<td><table><tr><td ctrlflip='right'>"+srcMac+"</td></tr>");
			document.write("<input type='hidden' id='id_hidden_srcmac_item1_"+rule_index+"' value=''>");
			document.write("<input type='hidden' id='id_hidden_srcmac_item2_"+rule_index+"' value=''>");
			document.write("<input type='hidden' id='id_hidden_srcmac_item3_"+rule_index+"' value=''>");
			document.write("<input type='hidden' id='id_hidden_srcmac_item4_"+rule_index+"' value=''>");
			document.write("<input type='hidden' id='id_hidden_srcmac_item5_"+rule_index+"' value=''>");
			document.write("<input type='hidden' id='id_hidden_srcmac_item6_"+rule_index+"' value=''>");
			document.write("</table></td>");
		}

		var wan_if = fvt_meta_config(pf_wanif_key);
		var wan_ifName = get_wan_name_by_interface(wan_if);
		document.write("<td ctrlflip='right'>"+wan_if+"("+wan_ifName+")<input type='hidden' id='id_hidden_wanif"+rule_index+"' value='"+wan_if+"'></td>");

		document.write("<td><table><tr>");
		document.write("<td ctrlflip='etc'><input type='button' value='Edit' class='submitBtn' onclick='editRule("+rule_index+");'></td>");
		document.write("<td ctrlflip='etc'><input type='button' value='Delete' class='submitBtn' onclick='deleteRule("+rule_index+");'></td>");
		document.write("<td ctrlflip='etc'><input type='button' value='"+type+"' class='submitBtn' onclick='SetPrf("+prfStatus+","+rule_index+");'></td>");
		document.write("</tr></table>");

		document.write("<input type='hidden' id='id_hidden_radio1_"+rule_index+"' value='"+radio1+"'>");

		document.write("</td>");
		document.write("</tr>");
	}
}

function fvt_form_init(form_name)
{
	var i=0;
	var rule_index;
	if (form_name=='pwd_form' || form_name=='*') {

	}
	else if (form_name=='prf_table_form' || form_name=='*') {
		for(i=0; i < maxrule; i++)
		{
			rule_index = i+1;
			var fw_pf_name = fvt_meta_config("nat0_classify_snat_"+rule_index+"_name");
			if (fw_pf_name == '')
			{
				continue;
			}
			NodeLength++;
		}
	}
}

function fvt_form_submit(form_name)		{
	var rule_index =0;

	var pf_en_key;
	var pf_name_key;
	var pf_proto_key;
	var pf_port_key;
	var pf_port_select_key;
	var pf_srcip_key;
	var pf_wanif_key;
	var port_range_val;
	var ip_and_mask;
	var pf_mac_key;

	rule_index = get_empty_index();

	fvt_paramlist_clear();
	if (form_name=='pwd_form' || form_name=='*')
	{

			if (edit_rule != 99)
			{
				rule_index = edit_rule;
			}
			pf_en_key = 'nat0_classify_snat_'+rule_index+'_en';
			pf_name_key = 'nat0_classify_snat_'+rule_index+'_name';
			pf_proto_key = 'nat0_classify_snat_'+rule_index+'_type';
			pf_port_key = 'nat0_classify_snat_'+rule_index+'_sport';
			pf_port_select_key = 'nat0_classify_snat_'+rule_index+'_port_select';
			pf_srcip_key = 'nat0_classify_snat_'+rule_index+'_srcip';
			pf_wanif_key = 'nat0_classify_snat_'+rule_index+'_to_wan';
			pf_mac_key = 'nat0_classify_snat_'+rule_index+'_mac';

			fvt_paramlist_cat_str(pf_en_key, "1");
			fvt_paramlist_cat_str(pf_name_key, fvt_form_obj_get("pwd_form", "PRFAP"));

			if(fvt_form_obj_get("pwd_form", "USERPROTO")=="NONE")
				{
				fvt_paramlist_cat_str(pf_proto_key, "");
				fvt_paramlist_cat_str(pf_port_key, "");
				}
			else if(fvt_form_obj_get("pwd_form", "USERPROTO")=="ICMP")
				{
				fvt_paramlist_cat_str(pf_proto_key, fvt_form_obj_get("pwd_form", "USERPROTO"));
				fvt_paramlist_cat_str(pf_port_key, "");
				}
			else
				{
				fvt_paramlist_cat_str(pf_proto_key, fvt_form_obj_get("pwd_form", "USERPROTO"));
				if (document.getElementById('id_PRFPORT2').checked == true)
					{
					fvt_paramlist_cat_str(pf_port_key,document.getElementById("id_manual_port").value);
					fvt_paramlist_cat_str(pf_port_select_key, "1");
					}
				else
					{
					port_range_val =  fvt_form_obj_get("pwd_form", "PORTSTART")+'-'+fvt_form_obj_get("pwd_form", "PORTEND");
					fvt_paramlist_cat_str(pf_port_key, port_range_val);
					fvt_paramlist_cat_str(pf_port_select_key, "2");
					}
				}

			ip_and_mask =  fvt_form_obj_get("pwd_form", "srcIP")+'/'+ fvt_form_obj_get("pwd_form", "srcNetmask");
			fvt_paramlist_cat_str(pf_srcip_key, ip_and_mask);

			fvt_paramlist_cat_str(pf_wanif_key, fvt_form_obj_get("pwd_form", "wanif"));
			fvt_paramlist_cat_str(pf_mac_key, fvt_form_obj_get("pwd_form", "srcMAC"));

			fvt_paramlist_presubmit(form_name);
			document.getElementById("id_edit_item").value="";
	}

}

</script>
</head>

<body align="left" onload="isBridgeMode();isFallRule();">
<div id="container">
<table align="center" width="90%"><tbody>
<tr><td valign="top">
<form id="id_pwd_form" name="pwd_form" method="post">
	<fieldset>
		<div class="lv1_title">Firewall Setup&nbsp;&gt;&nbsp;NAT classify</div>
	</fieldset>
<div class="div1_indent lv2_new">
	<input name="nosave_editEntry" id="id_edit_item" value="0" type="hidden">
	<input name="nosave_checkEntry" id="id_check_item" value="99" type="hidden">
	<table>
		<tr>
			<td class="width_portF1"><div ctrlflip="right" ctrlid="204">Name</div></td>
			<td class="width_portF3">
				<input ctrlflip="etc" name="PRFAP" id="id_PRFAP" size="12" maxlength="6" class="width_text80" type="text">
			</td>
		</tr>
		<tr>
			<td><div ctrlflip="right" ctrlid="205">Protocol</div></td>
			<td>
				<select ctrlflip="etc" name="USERPROTO" id="id_user_prot" onclick="checkProto();" onchange="checkProto();" class="width_select80">
					<option value="NONE" selected="selected">NONE</option>
					<option value="TCP">TCP</option>
					<option value="UDP">UDP</option>
					<option value="ICMP">ICMP</option>
				</select>
			</td>
		</tr>

		<tr>
			<td><div ctrlflip="right" ctrlid="210">Port</div></td>
			<td>
				<table><tr>
					<td>
						<input ctrlflip="etc" name="PRFPORT" id="id_PRFPORT2" onclick="checkPort();" value="SINGLE" class="radio" type="radio" checked disabled="disabled">
					</td>
					<td><div ctrlflip="etc" ctrlid="212">Single Port</div></td>
				</tr></table>
			</td>
			<td>
				<input ctrlflip="etc" disabled="disabled" name="PORTNUM" id="id_manual_port" size="5" maxlength="5" class="width_text80" type="text">
			</td>
		</tr>

		<tr>
			<td></td>
			<td>
				<table><tr>
					<td>
						<input ctrlflip="etc" name="PRFPORT" id="id_PRFPORT3" onclick="checkPort();" value="MULTI" class="radio" type="radio" disabled="disabled">
					</td>
					<td><div ctrlflip="etc" ctrlid="213">Port Range</div></td>
				</tr></table>
			</td>
			<td>
				<table><tr>
					<td>
						<input ctrlflip="etc" disabled="disabled" name="PORTSTART" id="id_manual_sport" size="5" maxlength="5" class="width_portF_port" type="text">&nbsp;-&nbsp;
					</td>
					<td>
						<input disabled="disabled" name="PORTEND" id="id_manual_eport" size="5" maxlength="5" class="width_portF_port" type="text">
					</td>
				</tr></table>
			</td>
		</tr>
		<tr>
			<td><div ctrlflip="right" ctrlid="214">Source&nbsp;IP&nbsp;Address</div></td>
			<td><table>
				<tr ctrlflip="etc">
					<td><input name="srcIP" id="id_srcIP" value="" type="hidden"></td>
					<td><input name="srcIPflag" id="id_srcIPflag" value="" type="hidden"></td>
					<td><input id="id_srcIP_item1" maxlength="3" class="width_ip" type="text">&nbsp;.&nbsp;</td>
					<td><input id="id_srcIP_item2" maxlength="3" class="width_ip" type="text">&nbsp;.&nbsp;</td>
					<td><input id="id_srcIP_item3" maxlength="3" class="width_ip" type="text">&nbsp;.&nbsp;</td>
					<td><input id="id_srcIP_item4" maxlength="3" class="width_ip" type="text"></td>
				</tr>
			</table></td>
			<td>
				<select ctrlflip="etc" name="srcNetmask" id="id_srcNetmask" class="width_select80">
					<option value="255.255.255.255">255.255.255.255</option>
					<option value="255.255.255.254">255.255.255.254</option>
					<option value="255.255.255.252">255.255.255.252</option>
					<option value="255.255.255.248">255.255.255.248</option>
					<option value="255.255.255.240">255.255.255.240</option>
					<option value="255.255.255.224">255.255.255.224</option>
					<option value="255.255.255.192">255.255.255.192</option>
					<option value="255.255.255.128">255.255.255.128</option>
					<option value="255.255.255.0" selected="selected">255.255.255.0</option>
					<option value="255.255.254.0">255.255.254.0</option>
					<option value="255.255.252.0">255.255.252.0</option>
					<option value="255.255.248.0">255.255.248.0</option>
					<option value="255.255.240.0">255.255.240.0</option>
					<option value="255.255.224.0">255.255.224.0</option>
					<option value="255.255.192.0">255.255.192.0</option>
					<option value="255.255.128.0">255.255.128.0</option>
					<option value="255.255.0.0">255.255.0.0</option>
					<option value="255.254.0.0">255.254.0.0</option>
					<option value="255.252.0.0">255.252.0.0</option>
					<option value="255.248.0.0">255.248.0.0</option>
					<option value="255.240.0.0">255.240.0.0</option>
					<option value="255.224.0.0">255.224.0.0</option>
					<option value="255.192.0.0">255.192.0.0</option>
					<option value="255.128.0.0">255.128.0.0</option>
					<option value="255.0.0.0">255.0.0.0</option>
					<option value="254.0.0.0">254.0.0.0</option>
					<option value="252.0.0.0">252.0.0.0</option>
					<option value="248.0.0.0">248.0.0.0</option>
					<option value="240.0.0.0">240.0.0.0</option>
					<option value="224.0.0.0">224.0.0.0</option>
					<option value="192.0.0.0">192.0.0.0</option>
					<option value="128.0.0.0">128.0.0.0</option>
					<!-- <option value="0.0.0.0">0.0.0.0</option> -->
				</select>
			</td>
		</tr>
		<tr>
			<td><div ctrlflip="right" ctrlid="215">Source&nbsp;MAC</div></td>
			<td>
				<table><tr>
					<td>
						<table><tr ctrlflip="etc">
							<td><input name="srcMAC" id="id_srcMAC" value="" type="hidden"></td>
							<td><input id="id_srcMAC_item1" class="width_ip" maxlength="2" type="text">:</td>
							<td><input id="id_srcMAC_item2" class="width_ip" maxlength="2" type="text">:</td>
							<td><input id="id_srcMAC_item3" class="width_ip" maxlength="2" type="text">:</td>
							<td><input id="id_srcMAC_item4" class="width_ip" maxlength="2" type="text">:</td>
							<td><input id="id_srcMAC_item5" class="width_ip" maxlength="2" type="text">:</td>
							<td><input id="id_srcMAC_item6" class="width_ip" maxlength="2" type="text"></td>
						</tr></table>
					</td>
				</tr></table>
			</td>
		</tr>
		<tr>
			<td><div ctrlflip="right" ctrlid="215">WAN&nbsp;Interface</div></td>
			<td>
				<table><tr>
					<td><select class='width_routeS_selectif' name="wanif" id="id_wanif" value='' class='width_select80'>
						<script>
							faceinter();
						</script>
					</select></td>
				</tr></table>
			</td>
		</tr>

		<tr><td>&nbsp;</td></tr>
		<tr id="id_apply_tr">
			<td></td>
			<td>
				<input ctrlflip="etc" id="add_applybtn" name="submitBtn" type="button" onclick="prf_check();" class="width_portAdd" value="Add">
			</td>
		</tr>
		<tr id="id_wait_progress" style="display:none">
			<td></td>
			<td>
				<img src="../images/progress1.gif">
			</td>
		</tr>

	</table>
</div>
</form>

<form id="id_prf_table_form" name="prf_table_form" method="post">
	<div> <hr class="hr2"></div>

<div class="div1_indent">
	<input ctrlflip="etc" name="nosave_deleteEntry" id="id_delete_item" value="0" type="hidden">
	<input ctrlflip="etc" name="nosave_prf_status"	id="id_prf_status"	value="0" type="hidden">
	<input ctrlflip="etc" name="nosave_statusEntry" id="id_status_item" value="0" type="hidden">
	<table><tbody>
		<tr class="lightgray">
			<td class="width_portF_name paddingleft"><div class="lv2_new" ctrlflip="right" ctrlid="204">Name</div></td>
			<td class="width_portF_pro"><div class="lv2_new" ctrlflip="right" ctrlid="205">Protocol</div></td>
			<td class="width_portF_port"><div class="lv2_new" ctrlflip="right" ctrlid="210">Port</div></td>
			<td class="width_portF_SIP align_center"><div class="lv2_new" ctrlflip="right" ctrlid="214">Source IP Address<br>Netmask</div></td>
			<td class="width_portF_SIP align_center"><div class="lv2_new" ctrlflip="right" ctrlid="250">Source MAC</div></td>
			<td class="width_portF_LIP align_center"><div class="lv2_new" ctrlflip="right" ctrlid="215">WAN Interface</div></td>
			<td class="align_center"><div class="lv2_new">Action</div></td>
		</tr>
		<tr style="height:5px;">
			<td colspan="7">
				<div><hr class="hr2"></div>
			</td>
		</tr>

		<script language="javascript" type="text/javascript">
			list_port_forward_rules();
		</script>
	</tbody></table>
</div>
</form>
</td></tr>
</tbody></table>
</div>

<br>
</body>
</html>

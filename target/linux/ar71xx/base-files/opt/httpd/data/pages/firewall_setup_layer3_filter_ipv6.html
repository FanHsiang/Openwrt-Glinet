<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<link rel="stylesheet" type="text/css" href="../css/common.css" media="all">
<script language="javascript" type="text/javascript" src="../js/menu_base.js"></script>
<script language="javascript" type="text/javascript" src="../js/menu.js"></script>
<script language="javascript" type="text/javascript" src="../js/common.js"></script>
<script language="javascript" type="text/javascript" src="../js/fvt.js"></script>
<style type="text/css">
td.darkgray{color: #808080;}
td.lightgray{color: #D3D3D3;}
table.TB_COLLAPSE { border-collapse:collapse;}
table.TB_COLLAPSE caption { padding:10px; font-size:24px; background-color:#f3f6f9;}
table.TB_COLLAPSE thead th { padding:5px 0px; font-size:13px; color:#fff; background-color:#915957;}
table.TB_COLLAPSE tbody td { padding:5px 0px; font-size:13px; color:#888; text-align:center; border:1px solid #915957;}
table.TB_COLLAPSE tbody td.hlight { padding:5px 0px; font-size:13px; color:#333; text-align:center; border:1px solid #915957;}
</style>
<script language="javascript" type="text/javascript">

var filter_max = 16;

function check_process()
{
	var process="Success";
	if (process=="Existed")
		alert("Please wait!!Another client is upgading firmware.");
}

function Remove_L3Rule(Rule)
{
	fvt_paramlist_clear();
	var	f_name_key = 'fw_ipv6_acl'+Rule+'_name';
	var	f_enable_key = 'fw_ipv6_acl'+Rule+'_en';
	var	f_ip_type_key = 'fw_ipv6_acl'+Rule+'_type';
	var	f_protocol_key = 'fw_ipv6_acl'+Rule+'_proto';
	var	f_action_key = 'fw_ipv6_acl'+Rule+'_action';
	var	f_srcip_key = 'fw_ipv6_acl'+Rule+'_srcip';
	var	f_srcpl_key = 'fw_ipv6_acl'+Rule+'_srcpl';
	var	f_sportstart_key = 'fw_ipv6_acl'+Rule+'_sport';
	var	f_sportend_key = 'fw_ipv6_acl'+Rule+'_sportend';
	var	f_dstip_key = 'fw_ipv6_acl'+Rule+'_dstip';
	var	f_dstpl_key = 'fw_ipv6_acl'+Rule+'_dstpl';
	var	f_dportstart_key = 'fw_ipv6_acl'+Rule+'_dport';
	var	f_dportend_key = 'fw_ipv6_acl'+Rule+'_dportend';

	fvt_paramlist_cat_str(f_name_key, "");
	fvt_paramlist_cat_str(f_enable_key, "0");
	fvt_paramlist_cat_str(f_ip_type_key, "");
	fvt_paramlist_cat_str(f_protocol_key, "");
	fvt_paramlist_cat_str(f_srcip_key, "");
	fvt_paramlist_cat_str(f_srcpl_key, "");
	fvt_paramlist_cat_str(f_sportstart_key, "");
	fvt_paramlist_cat_str(f_sportend_key, "");
	fvt_paramlist_cat_str(f_dstip_key, "");
	fvt_paramlist_cat_str(f_dstpl_key, "");
	fvt_paramlist_cat_str(f_dportstart_key, "");
	fvt_paramlist_cat_str(f_dportend_key, "");
	fvt_paramlist_cat_str(f_action_key, "");

	fvt_paramlist_presubmit('l3_filter_ipv6_form');
	document.getElementById('l3_filter_ipv6_form').submit();
}

function ADD_L3_Rule()
{
	var k;
	var have_empty = 0;
	for(k=0; k<filter_max; k++)
	{
		var f_name_key = 'fw_ipv6_acl'+k+'_name';
		if (fvt_meta_config(f_name_key) !="")
			{
			continue;
			}
		else
			{
			have_empty = 1;
			break;
			}
	}
	if (have_empty == 1)
		window.location.href="wwwctrl.cgi?action=l3_sub_ipv6&l3r="+k;
	else
	{
		alert ("Layer 3 firewall exceed maximum entries [ " + filter_max+ " ]!");
		return;
	}

}

function L3_RuleionURL(Rule)
{
	window.location.href="wwwctrl.cgi?action=l3_sub_ipv6&l3r="+Rule;
}

function list_l3_ipv6_filter(L3_Rule)
{
	var	f_name_key = 'fw_ipv6_acl'+L3_Rule+'_name';
	var	f_enable_key = 'fw_ipv6_acl'+L3_Rule+'_en';
	var	f_ip_type_key = 'fw_ipv6_acl'+L3_Rule+'_type';
	var	f_action_key = 'fw_ipv6_acl'+L3_Rule+'_action';
	var	f_protocol_key = 'fw_ipv6_acl'+L3_Rule+'_proto';

	var	f_srcip_key = 'fw_ipv6_acl'+L3_Rule+'_srcip';
	var	f_srcpl_key = 'fw_ipv6_acl'+L3_Rule+'_srcpl';
	var	f_sportstart_key = 'fw_ipv6_acl'+L3_Rule+'_sport';
	var	f_sportend_key = 'fw_ipv6_acl'+L3_Rule+'_sportend';
	var	f_dstip_key = 'fw_ipv6_acl'+L3_Rule+'_dstip';
	var	f_dstpl_key = 'fw_ipv6_acl'+L3_Rule+'_dstpl';
	var	f_dportstart_key = 'fw_ipv6_acl'+L3_Rule+'_dport';
	var	f_dportend_key = 'fw_ipv6_acl'+L3_Rule+'_dportend';

	var empty_rule=1;
	if (fvt_meta_config(f_name_key) !="")
	{
		document.write("<tr style='text-align:center'>");
		empty_rule=0;
		if (fvt_meta_config(f_enable_key) =="1") document.write("<td class='hlight'>Enable</td>");
		else document.write("<td>Disable</td>");

		document.write("<td><input type='button' value='Edit' onclick='L3_RuleionURL("+L3_Rule+")' target='contentfrm'>");
		document.write("<input type='button' value='Remove' onclick='Remove_L3Rule("+L3_Rule+")' target='contentfrm'></td>");
		document.write("<td class='hlight'>"+fvt_meta_config(f_name_key)+"</td>");

		var In_Out=fvt_meta_config(f_ip_type_key)
		if (In_Out == "INBOUND") document.write("<td class='hlight'>Incoming</td>");
		else if (In_Out == "OUTBOUND") document.write("<td class='hlight'>Outgoing</td>");
		else document.write("<td></td>");

		document.write("<td class='hlight'>"+fvt_meta_config(f_protocol_key)+"</td>");
		document.write("<td class='hlight'>"+fvt_meta_config(f_action_key)+"</td>");

		var srcip=fvt_meta_config(f_srcip_key);
		var srcpl=fvt_meta_config(f_srcpl_key);
		if (empty_rule==1)document.write("<td></td>");
		else if (srcip !="") document.write("<td>"+srcip+"/"+srcpl+"</td>");
		else document.write("<td>ALL</td>");

		var srcpstart=fvt_meta_config(f_sportstart_key);
		var srcpend=fvt_meta_config(f_sportend_key);
		if (empty_rule==1)document.write("<td></td>");
		else if (srcpstart == "" && srcpend == "") document.write("<td>ALL</td>");
		else if (srcpstart != srcpend) document.write("<td>"+srcpstart+" - "+srcpend+"</td>");
		else document.write("<td>"+srcpstart+"</td>");

		var dstip=fvt_meta_config(f_dstip_key);
		var dstpl=fvt_meta_config(f_dstpl_key);
		if (empty_rule==1)document.write("<td></td>");
		else if (dstip !="") document.write("<td>"+dstip+"/"+dstpl+"</td>");
		else document.write("<td>ALL</td>");

		var dstpstart=fvt_meta_config(f_dportstart_key);
		var dstpend=fvt_meta_config(f_dportend_key);
		if (empty_rule==1)document.write("<td></td>");
		else if (dstpstart == "" && dstpend == "") document.write("<td>ALL</td>");
		else if (dstpstart != dstpend) document.write("<td>"+dstpstart+" - "+dstpend+"</td>");
		else document.write("<td>"+dstpstart+"</td>");

		document.write("</tr>");
	}
}

function fvt_form_submit()
{
	fvt_paramlist_cat_str('fw_block_private_ip', fvt_form_obj_get("l3_filter_ipv6_form", "block_private_ip_enable"));
	fvt_paramlist_cat_str('fw_ipv6_acl_enable', fvt_form_obj_get("l3_filter_ipv6_form", "acl_enable"));
	fvt_paramlist_presubmit('l3_filter_ipv6_form');
	document.getElementById('l3_filter_ipv6_form').submit();
}

function fvt_form_init()
{
	fvt_form_obj_set("l3_filter_ipv6_form", "block_private_ip_enable", fvt_meta_config('fw_block_private_ip'));
	fvt_form_obj_set("l3_filter_ipv6_form", "acl_enable", fvt_meta_config('fw_ipv6_acl_enable'));
	check_acl_enable();
}

function check_acl_enable()
{
	//var acl_enable = parseInt(document.getElementById("id_acl_enable").value, 10);
	var acl_enable = parseInt(fvt_meta_config('fw_ipv6_acl_enable'), 10);
	var table1=document.getElementById('filter_ipv6table');

	if(acl_enable == 0)
		table1.style.display="none";
	else
		table1.style.display="";
}
</script>
</head>

<body align="left" onload="fvt_form_init();check_process();">
<div id="container">
<table align="center" width="90%"><tbody>
<tr><td valign="top">
<form id="l3_filter_ipv6_form" name="l3_filter_ipv6_form" method="post">
	<fieldset>
		<div class="lv1_title">Firewall Setup&nbsp;&gt;&nbsp;IPv6 Layer 3 Filter</div>
	</fieldset>
	<fieldset>
		<div class="lv2_title" style="display:none;margin:10px 0em">
			Block Traffic from WAN to LAN side IP
			<select id="block_private_ip_enable" class="width_select40" name="block_private_ip_enable">
				<option value="1">Enable</option>
				<option value="0">Disable</option>
			</select>
		</div>
		<div class="lv2_title" style="margin:10px 0em">
			IPv6 Access Restriction
			<select id="id_acl_enable" class="width_select40" name="acl_enable" onchange="check_acl_enable()">
				<option value="1">Enable</option>
				<option value="0">Disable</option>
			</select>
		</div>
		<div class="lv2_title" style="margin:10px 0em">
		<input type="button" onclick="fvt_form_submit()" id="add_applybtn" class="width_button" name="applybtn" value="Apply Changes">
		</div>
		<div><hr class="hr2"></div>

	<div id="filter_ipv6table" style="display:none">
		<div class="lv2_title" style="margin:10px 0em">
			IPv6 Layer 3 Filter Rule List:
		</div>
		<div class="lv3_title" style="margin:10px 0em">
			<input type='button' value='Add New Entry' onclick='ADD_L3_Rule()' target='contentfrm'>
			&nbsp;&nbsp;&nbsp;(A maximum 16 entries can be configured)
		</div>
		<div class="lv2_title" style="margin:10px 0em">
		<table class="TB_COLLAPSE"><tbody>
		<tr style="text-align:center">
			<td class='hlight' style="width:70px;">Rule</td>
			<td class='hlight' style="width:130px;">Edit</td>
			<td class='hlight' style="width:120px;">Filter Name</td>
			<td class='hlight' style="width:90px;">Direction</td>
			<td class='hlight' style="width:90px;">Protocol</td>
			<td class='hlight' style="width:90px;">Action</td>
			<td class='hlight' style="width:200px;">Source IP/Prefix</td>
			<td class='hlight' style="width:110px;">Source Port</td>
			<td class='hlight' style="width:200px;">Destination IP/Prefix</td>
			<td class='hlight' style="width:110px;">Destination Port</td>
		</tr>

		<script language="javascript" type="text/javascript">
			for(i=0; i<filter_max; i++)
			{
				list_l3_ipv6_filter(i);
			}
		</script>
			<tr id="id_wait_progress" style="display:none">
				<td width="800px" align="center">
						<img src="../images/progress1.gif">
				</td>
			</tr>
		</tbody></table>
		</div>
	</div>

</div>
</form>
</td></tr>
</tbody></table>

</body>
</html>
